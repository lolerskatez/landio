<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Load theme manager early to apply preferences before page renders -->
    <script src="theme.js"></script>
    <!-- QRCode library for 2FA setup -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* Base styles - Matching original theme */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        :root {
            --primary: #ff6b93;
            --secondary: #a6d8ff;
            --accent: #ffccd5;
            --text: #5a5a5a;
            --light-bg: #fff9fb;
            --dark: #4a4a4a;
        }
        
        body {
            background: linear-gradient(135deg, #ffd1dc, #c9e9ff);
            min-height: 100vh;
            color: var(--text);
            padding: 20px;
        }
        
        /* ============================================ */
        /* THEME SYSTEM - 3 Themes */
        /* ============================================ */

        /* THEME 0: Original Pastel (Default) */
        body.theme-pastel {
            --primary: #ff6b93;
            --secondary: #a6d8ff;
            --accent: #ffccd5;
            --text: #5a5a5a;
            --light-bg: #fff9fb;
            --dark: #4a4a4a;
            background: linear-gradient(135deg, #ffd1dc, #c9e9ff);
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* THEME 1: Cyber Sakura */
        body.theme-cyber {
            --primary: #FF5FA2;
            --primary-glow: #FF9BD4;
            --neon-blue: #00E0FF;
            --neon-purple: #C77DFF;
            --bg-main: #0E0A1F;
            --bg-card: #1C1433;
            --bg-surface: #241A40;
            --text-primary: #FFFFFF;
            --text-secondary: #C9BEEA;
            --success: #00FFA3;
            --warning: #FFC93C;
            --error: #FF4F70;
            background: linear-gradient(135deg, #0E0A1F, #1A0F2E);
            font-family: 'Poppins', sans-serif;
            color: #FFFFFF;
            min-height: 100vh;
            padding: 20px;
        }

        /* THEME 2: Sunset Gradient */
        body.theme-sunset {
            --primary: #FF6A3D;
            --primary-dark: #D44A20;
            --gradient-start: #FF6A3D;
            --gradient-end: #A14BFF;
            --bg-main: #FFF7F3;
            --bg-card: #FFFFFF;
            --bg-surface: #F7EEE9;
            --text-primary: #2F2F2F;
            --text-secondary: #5A5A5A;
            --success: #46C371;
            --warning: #F7C14E;
            --error: #E44A57;
            background: linear-gradient(135deg, #FF6A3D, #A14BFF);
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        /* ============================================ */
        /* THEME-AWARE COMPONENT STYLING */
        /* ============================================ */

        /* Applied to active themes */
        body.theme-pastel,
        body.theme-cyber,
        body.theme-sunset {
            color: var(--text-primary);
        }

        /* Navigation Bar - All Themes */
        body.theme-cyber header,
        body.theme-cyber nav {
            background: rgba(28, 20, 51, 0.95) !important;
            color: #FFFFFF !important;
        }

        body.theme-cyber header button,
        body.theme-cyber nav button {
            background: rgba(255, 95, 162, 0.15) !important;
            color: #FF9BD4 !important;
            border: 1px solid rgba(255, 95, 162, 0.3) !important;
        }

        body.theme-cyber header button:hover,
        body.theme-cyber nav button:hover {
            background: rgba(255, 95, 162, 0.25) !important;
            box-shadow: 0 0 10px rgba(255, 95, 162, 0.3) !important;
        }

        body.theme-sunset header,
        body.theme-sunset nav {
            background: rgba(255, 255, 255, 0.95) !important;
            color: var(--text-primary) !important;
        }

        /* Settings Tabs - All Themes */
        body.theme-cyber .settings-tabs {
            background: rgba(36, 26, 64, 0.9) !important;
            border: 1px solid rgba(255, 95, 162, 0.2) !important;
        }

        body.theme-cyber .settings-tab {
            color: var(--text-secondary) !important;
        }

        body.theme-cyber .settings-tab:hover,
        body.theme-cyber .settings-tab.active {
            color: var(--primary-glow) !important;
        }

        body.theme-sunset .settings-tabs {
            background: rgba(255, 255, 255, 0.95) !important;
        }

        body.theme-sunset .settings-tab {
            color: var(--text-secondary) !important;
        }

        body.theme-sunset .settings-tab.active,
        body.theme-sunset .settings-tab:hover {
            color: var(--primary) !important;
        }

        /* Cards & Containers - All Themes */
        body.theme-cyber .settings-section,
        body.theme-cyber .card {
            background: rgba(36, 26, 64, 0.8) !important;
            color: var(--text-primary) !important;
            border: 1px solid rgba(255, 95, 162, 0.2) !important;
        }

        body.theme-cyber .form-group {
            background: transparent !important;
            border: none !important;
            padding: 15px 0 !important;
            margin-top: 20px !important;
        }

        body.theme-sunset .settings-section,
        body.theme-sunset .form-group,
        body.theme-sunset .card {
            background: rgba(255, 255, 255, 0.95) !important;
            color: var(--text-primary) !important;
        }

        /* User Cards - Cyber Theme */
        body.theme-cyber .user-card {
            background: rgba(28, 20, 51, 0.95) !important;
            border: 2px solid rgba(0, 224, 255, 0.3) !important;
            box-shadow: 0 5px 20px rgba(0, 224, 255, 0.2) !important;
        }

        body.theme-cyber .user-card:hover {
            border-color: rgba(0, 224, 255, 0.6) !important;
            box-shadow: 0 10px 30px rgba(0, 224, 255, 0.3), 0 0 20px rgba(255, 95, 162, 0.2) !important;
        }

        body.theme-cyber .user-name {
            color: #00E0FF !important;
        }

        body.theme-cyber .user-email {
            color: #C9BEEA !important;
        }

        /* User Cards - Sunset Theme */
        body.theme-sunset .user-card {
            background: rgba(255, 255, 255, 0.95) !important;
        }

        /* Inputs - All Themes */
        body.theme-cyber input,
        body.theme-cyber select,
        body.theme-cyber textarea {
            background: rgba(20, 20, 30, 0.8) !important;
            color: #FFFFFF !important;
            border: 1px solid rgba(0, 224, 255, 0.3) !important;
        }

        body.theme-cyber input:focus,
        body.theme-cyber select:focus,
        body.theme-cyber textarea:focus {
            border-color: rgba(0, 224, 255, 0.6) !important;
            box-shadow: 0 0 10px rgba(0, 224, 255, 0.2) !important;
        }

        body.theme-cyber .setting-card input,
        body.theme-cyber .setting-card select,
        body.theme-cyber .setting-card textarea {
            background: rgba(14, 10, 31, 0.6) !important;
            border: 1px solid rgba(0, 224, 255, 0.25) !important;
            outline: none !important;
        }

        body.theme-cyber .setting-card input:focus,
        body.theme-cyber .setting-card select:focus,
        body.theme-cyber .setting-card textarea:focus {
            background: rgba(14, 10, 31, 0.8) !important;
            border-color: rgba(0, 224, 255, 0.5) !important;
            box-shadow: 0 0 15px rgba(0, 224, 255, 0.15) !important;
        }

        body.theme-cyber input::placeholder,
        body.theme-cyber select::placeholder,
        body.theme-cyber textarea::placeholder {
            color: rgba(201, 190, 234, 0.5) !important;
        }

        /* Cyber Theme - Toggle Switches */
        body.theme-cyber .slider {
            background-color: rgba(20, 20, 30, 0.8) !important;
            border: 1px solid rgba(0, 224, 255, 0.3) !important;
        }

        body.theme-cyber input:checked + .slider {
            background: linear-gradient(135deg, rgba(255, 95, 162, 0.8), rgba(199, 125, 255, 0.8)) !important;
            border-color: rgba(255, 95, 162, 0.5) !important;
            box-shadow: 0 0 15px rgba(255, 95, 162, 0.3) !important;
        }

        body.theme-cyber .slider:before {
            background-color: #FFFFFF !important;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) !important;
        }

        /* Cyber Theme - Remove all outlines and borders from form elements */
        body.theme-cyber .form-group input,
        body.theme-cyber .form-group select,
        body.theme-cyber .form-group textarea {
            outline: none !important;
            box-shadow: none !important;
        }

        body.theme-cyber .form-group input[type="number"],
        body.theme-cyber .form-group input[type="text"],
        body.theme-cyber .form-group input[type="email"],
        body.theme-cyber .form-group input[type="password"] {
            background: rgba(14, 10, 31, 0.6) !important;
            border: 1px solid rgba(0, 224, 255, 0.25) !important;
            color: #FFFFFF !important;
            outline: none !important;
        }

        body.theme-cyber .form-group input[type="number"]:focus,
        body.theme-cyber .form-group input[type="text"]:focus,
        body.theme-cyber .form-group input[type="email"]:focus,
        body.theme-cyber .form-group input[type="password"]:focus {
            background: rgba(14, 10, 31, 0.8) !important;
            border-color: rgba(0, 224, 255, 0.5) !important;
            box-shadow: 0 0 15px rgba(0, 224, 255, 0.15) !important;
        }

        body.theme-cyber .setting-card .form-group {
            background: transparent !important;
            border: none !important;
        }

        body.theme-cyber .toggle-label {
            color: #C9BEEA !important;
        }

        body.theme-cyber label {
            color: #00E0FF !important;
        }

        body.theme-cyber .input-addon {
            color: #C9BEEA !important;
        }

        body.theme-sunset input,
        body.theme-sunset select,
        body.theme-sunset textarea {
            background: rgba(255, 255, 255, 0.9) !important;
            color: var(--text-primary) !important;
        }

        /* Buttons - All Themes */
        body.theme-cyber .btn {
            background: rgba(255, 95, 162, 0.1) !important;
            color: var(--primary-glow) !important;
            border: 1px solid rgba(255, 95, 162, 0.3) !important;
        }

        body.theme-cyber .btn:hover {
            background: rgba(255, 95, 162, 0.2) !important;
            box-shadow: 0 0 10px rgba(255, 95, 162, 0.3) !important;
        }

        body.theme-cyber .btn-primary {
            background: rgba(255, 95, 162, 0.2) !important;
            color: var(--primary-glow) !important;
            border: 2px solid var(--primary) !important;
        }

        body.theme-cyber .btn-primary:hover {
            background: var(--primary) !important;
            color: #FFFFFF !important;
            box-shadow: 0 0 15px rgba(255, 95, 162, 0.5) !important;
        }

        /* Light Theme Buttons */
        body.theme-sunset .btn {
            background: rgba(255, 255, 255, 0.8) !important;
            border: 1px solid var(--primary) !important;
            color: var(--primary) !important;
        }

        body.theme-sunset .btn:hover {
            background: var(--primary) !important;
            color: #FFFFFF !important;
        }

        body.theme-sunset .btn-primary {
            background: var(--primary) !important;
            color: #FFFFFF !important;
            border: 1px solid var(--primary) !important;
        }

        body.theme-sunset .btn-primary:hover {
            background: var(--primary-dark) !important;
            border-color: var(--primary-dark) !important;
        }

        /* Navigation Button Styling - Sunset Theme */
        body.theme-sunset .nav-btn {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #2F2F2F !important;
            border: 1px solid rgba(255, 106, 61, 0.2) !important;
        }

        body.theme-sunset .nav-btn:hover {
            background: rgba(255, 106, 61, 0.1) !important;
            color: #2F2F2F !important;
        }

        body.theme-sunset .nav-btn.active {
            background: var(--primary) !important;
            color: #FFFFFF !important;
        }

        /* Headings - All Themes */
        body.theme-cyber h1,
        body.theme-cyber h2,
        body.theme-cyber h3 {
            color: var(--primary-glow) !important;
            text-shadow: 0 0 10px rgba(255, 95, 162, 0.4) !important;
        }

        body.theme-sunset h1,
        body.theme-sunset h2,
        body.theme-sunset h3 {
            color: var(--primary) !important;
        }

        /* Labels & Text - All Themes */
        body.theme-sunset label {
            color: var(--text-primary) !important;
        }

        /* Toggle Switches - All Themes */
        body.theme-sunset input[type="checkbox"],
        body.theme-sunset input[type="radio"] {
            accent-color: var(--primary) !important;
        }

        /* Setting Cards - Theme Specific */
        body.theme-cyber .setting-card {
            background: rgba(36, 26, 64, 0.8) !important;
            border-left: 5px solid var(--primary) !important;
            color: #FFFFFF !important;
        }

        body.theme-cyber .setting-card .setting-name {
            color: var(--primary-glow) !important;
        }

        body.theme-cyber .setting-card .setting-description {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        body.theme-sunset .setting-card {
            background: rgba(255, 255, 255, 0.95) !important;
            border-left: 5px solid var(--primary) !important;
        }

        .container {
            margin: 0;
            padding: 0 20px;
        }

        /* Notification animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(400px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }
        
        /* Header styles */
        header {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px rgba(255, 182, 193, 0.3);
        }
        
        .subtitle {
            color: #7a7a7a;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        /* Character container */
        .character-container {
            position: relative;
            height: 200px;
            margin: 30px 0;
        }
        
        .character {
            position: absolute;
            bottom: 0;
            width: 150px;
            height: 180px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 180"><circle cx="75" cy="45" r="35" fill="%23ffccd5"/><path d="M75,80 Q75,120 45,140 Q75,160 105,140 Q75,120 75,80" fill="%23ffccd5"/><circle cx="60" cy="40" r="5" fill="%23333"/><circle cx="90" cy="40" r="5" fill="%23333"/><path d="M65,55 Q75,65 85,55" stroke="%23333" stroke-width="2" fill="none"/><path d="M50,100 Q75,130 100,100" stroke="%23ff6b93" stroke-width="3" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: center bottom;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .bubble {
            position: absolute;
            top: 20px;
            right: 30px;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 250px;
            text-align: left;
            font-size: 0.9rem;
            color: var(--text);
            border: 2px solid var(--accent);
        }
        
        .bubble:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 20px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
        }
        
        /* Main content area */
        .admin-content {
            display: block;
            width: 100%;
        }
        
        @media (max-width: 900px) {
            .admin-content {
                display: block;
            }
        }
        
        /* Settings subnavigation tabs */
        .settings-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .settings-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #7a7a7a;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-tab:hover {
            color: var(--primary);
        }

        .settings-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Settings sections - hide by default */
        .settings-section {
            display: none;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        /* Show only active tab content - with !important to ensure it overrides */
        .settings-section.active-tab {
            display: block !important;
        }
        
        .section-title {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .setting-card {
            background: var(--light-bg);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid var(--primary);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .setting-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .setting-name {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-description {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
            color: #7a7a7a;
        }
        
        /* Form elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--accent);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .input-addon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-weight: bold;
            pointer-events: none;
        }
        
        .form-group {
            position: relative;
        }
        
        .toggle-label {
            margin-left: 10px;
            font-weight: bold;
            color: var(--primary);
        }
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        /* Button styles */
        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-weight: bold;
            flex: 1;
            text-align: center;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 147, 0.3);
        }
        
        .btn-primary:hover {
            background: #ff4d7d;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 147, 0.4);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: #3a7bb8;
            box-shadow: 0 5px 15px rgba(166, 216, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: #8bcaff;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(166, 216, 255, 0.4);
        }
        
        .btn-danger {
            background: #ff8a8a;
            color: white;
            box-shadow: 0 5px 15px rgba(255, 138, 138, 0.3);
        }
        
        .btn-danger:hover {
            background: #ff6b6b;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 138, 138, 0.4);
        }
        
        /* Footer styles */
        footer {
            margin-top: 40px;
            text-align: center;
            color: #999;
            font-size: 0.9rem;
            padding: 20px;
        }
        
        /* Decorative elements */
        .decoration {
            position: absolute;
            z-index: -1;
        }
        
        .decoration-1 {
            top: -50px;
            left: -50px;
            width: 150px;
            height: 150px;
            background: rgba(255, 182, 193, 0.2);
            border-radius: 50%;
        }
        
        .decoration-2 {
            bottom: -30px;
            right: -30px;
            width: 120px;
            height: 120px;
            background: rgba(166, 216, 255, 0.2);
            border-radius: 50%;
        }
        
        /* User info bar */
        .user-info {
            background: var(--light-bg);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid var(--primary);
        }

        .user-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-name {
            font-weight: bold;
            color: var(--primary);
        }

        .user-role {
            font-size: 0.8rem;
            color: #7a7a7a;
            background: var(--accent);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }
        
        .status-online {
            background: #e8f7e8;
            color: #2e7d32;
        }
        
        .status-offline {
            background: #ffe8e8;
            color: #c62828;
        }
        
        /* System info */
        .system-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .info-label {
            font-size: 0.8rem;
            color: #7a7a7a;
        }
        
        /* Responsive adjustments */
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 0;
            }
            
            header, .settings-section {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .character-container {
                height: 160px;
                margin: 20px 0;
            }
            
            .character {
                width: 100px;
                height: 130px;
            }
            
            .bubble {
                top: 5px;
                right: 5px;
                left: auto;
                max-width: 200px;
                font-size: 0.8rem;
                padding: 12px;
            }
            
            .user-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .user-details {
                flex-direction: column;
                gap: 8px;
            }
            
            .user-actions .btn {
                min-height: 44px;
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .nav {
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }
            
            .nav-btn {
                width: 100%;
                min-height: 48px;
                padding: 14px 20px;
                font-size: 1rem;
                justify-content: center;
            }
            
            .admin-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .setting-card {
                padding: 15px;
            }
            
            .form-group input, 
            .form-group textarea, 
            .form-group select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 14px 15px;
                min-height: 48px;
            }
            
            .buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .buttons .btn {
                min-height: 48px;
                padding: 14px 20px;
                font-size: 1rem;
            }
            
            .system-info {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .info-card {
                padding: 15px;
                text-align: center;
            }
            
            .section-title {
                font-size: 1.4rem;
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header, .settings-section {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .character-container {
                height: 140px;
            }
            
            .character {
                width: 80px;
                height: 110px;
            }
            
            .bubble {
                max-width: 160px;
                font-size: 0.75rem;
                padding: 10px;
            }
            
            .user-info {
                padding: 12px;
            }
            
            .user-avatar {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .user-name {
                font-size: 1.1rem;
            }
            
            .user-role {
                font-size: 0.9rem;
            }
            
            .nav-btn {
                padding: 12px 16px;
                font-size: 0.95rem;
            }
            
            .setting-card h3 {
                font-size: 1.2rem;
            }
            
            .setting-description {
                font-size: 0.9rem;
            }
            
            .system-info {
                grid-template-columns: 1fr;
            }
            
            .info-value {
                font-size: 1.5rem;
            }
            
            .info-label {
                font-size: 0.9rem;
            }
        }
        
        /* Dark Mode Styles */
        .dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #888888;
            --border-color: #444444;
            --primary: #ff6b9d;
            --primary-hover: #ff8bb3;
            --secondary: #4ecdc4;
            --secondary-hover: #6fd5cc;
            --success: #51cf66;
            --warning: #ffd43b;
            --error: #ff6b6b;
            --card-bg: #2d2d2d;
            --input-bg: #3d3d3d;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        .dark-mode .container {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .dark-mode .setting-card,
        .dark-mode .info-card {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        .dark-mode .form-control,
        .dark-mode .form-group select,
        .dark-mode .form-group textarea {
            background: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        .dark-mode .form-control:focus,
        .dark-mode .form-group select:focus,
        .dark-mode .form-group textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.2);
        }
        
        .dark-mode .btn {
            background: var(--bg-secondary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        .dark-mode .btn:hover {
            background: var(--bg-tertiary);
        }
        
        .dark-mode .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .dark-mode .btn-primary:hover {
            background: var(--primary-hover);
        }
        
        .dark-mode .character {
            background: var(--bg-secondary);
            border-color: var(--border-color);
        }
        
        .dark-mode .bubble {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        .dark-mode .bubble::after {
            border-color: transparent transparent transparent var(--bg-secondary);
        }
        
        /* Accessibility Styles */
        .font-small {
            font-size: 14px;
        }
        
        .font-small * {
            font-size: inherit;
        }
        
        .font-medium {
            font-size: 16px;
        }
        
        .font-medium * {
            font-size: inherit;
        }
        
        .font-large {
            font-size: 18px;
        }
        
        .font-large * {
            font-size: inherit;
        }
        
        .font-extra-large {
            font-size: 20px;
        }
        
        .font-extra-large * {
            font-size: inherit;
        }
        
        .high-contrast {
            --text-primary: #ffffff;
            --text-secondary: #ffffff;
            --bg-primary: #000000;
            --bg-secondary: #000000;
            --border-color: #ffffff;
            --primary: #ffff00;
            --secondary: #00ffff;
        }
        
        .high-contrast .setting-card,
        .high-contrast .info-card {
            border: 2px solid var(--border-color);
        }
        
        .reduce-motion * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        .animations-enabled .character {
            animation: float 3s ease-in-out infinite;
        }
        
        .animations-enabled .bubble {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Focus and accessibility improvements */
        .setting-card:focus-within,
        .btn:focus,
        .form-control:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Screen reader only text */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* User Management Styles */
        #add-user-btn {
            padding: 6px 12px !important;
            font-size: 0.85rem;
            white-space: nowrap;
            max-width: 120px;
        }

        .user-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid var(--secondary);
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 107, 147, 0.2);
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-btn:hover {
            background: var(--secondary);
            transform: translateY(-50%) scale(1.1);
        }

        .filter-select {
            padding: 12px 20px;
            border: 2px solid var(--secondary);
            border-radius: 25px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .user-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: white;
        }

        .user-name {
            font-size: 1.4rem;
            color: var(--dark);
            margin-bottom: 8px;
            text-align: center;
        }

        .user-email {
            color: #7a7a7a;
            font-size: 0.95rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .user-role {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            text-transform: uppercase;
            margin: 10px auto;
            display: block;
            text-align: center;
            width: fit-content;
        }

        .role-admin {
            background: rgba(255, 107, 147, 0.2);
            color: var(--primary);
        }

        .role-poweruser {
            background: rgba(166, 216, 255, 0.2);
            color: var(--secondary);
        }

        .role-user {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .user-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .status-active {
            color: #2ed573;
        }

        .status-inactive {
            color: #ff4757;
        }

        .user-2fa-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 10px 0;
        }

        .user-2fa-status.tfa-enabled {
            background: rgba(46, 213, 115, 0.15);
            color: #2ed573;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }

        .user-2fa-status.tfa-disabled {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .user-2fa-status i {
            font-size: 1rem;
        }

        .user-activity {
            background: rgba(166, 216, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.85rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: #666;
        }

        .activity-item:last-child {
            margin-bottom: 0;
        }

        .activity-item i {
            width: 20px;
            text-align: center;
            color: var(--primary);
        }

        .activity-item .online {
            color: #2ed573;
        }

        .activity-item .offline {
            color: #999;
        }

        .activity-label {
            font-weight: 600;
            min-width: 90px;
        }

        .activity-value {
            color: var(--dark);
        }

        .user-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .user-actions button {
            flex: 1;
        }

        #users-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        #users-empty-state svg {
            margin-bottom: 20px;
            color: var(--secondary);
        }

        #users-empty-state h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-form {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }

        .password-input-group {
            display: flex;
            gap: 10px;
        }

        .password-input-group input {
            flex: 1;
        }

        .password-input-group button {
            white-space: nowrap;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-buttons button {
            flex: 1;
        }

        .modal-footer {
            background: rgba(166, 216, 255, 0.1);
            padding: 20px 30px;
            border-radius: 0 0 20px 20px;
        }

        .modal-footer h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .modal-footer p {
            margin: 8px 0;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .users-grid {
                grid-template-columns: 1fr;
            }
            
            .user-controls {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
        }

        /* Service Management Styles */
        .service-card-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-card, white);
            border: 1px solid var(--primary, #ff6b93);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .service-card-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .service-icon-display {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 107, 147, 0.1);
            border-radius: 8px;
            flex-shrink: 0;
        }

        .service-info {
            flex: 1;
        }

        .service-name-display {
            font-weight: bold;
            color: var(--text-primary, #333);
            margin: 0;
        }

        .service-url-display {
            font-size: 12px;
            color: var(--text-secondary, #666);
            margin: 5px 0 0 0;
            word-break: break-all;
        }

        .service-status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 5px;
        }

        .service-status-badge.online {
            background: #4CAF50;
            color: white;
        }

        .service-status-badge.offline {
            background: #f44336;
            color: white;
        }

        .service-status-badge.maintenance {
            background: #ff9800;
            color: white;
        }

        .service-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .service-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .service-actions .btn-edit {
            background: #2196F3;
            color: white;
        }

        .service-actions .btn-edit:hover {
            background: #1976D2;
        }

        .service-actions .btn-delete {
            background: #f44336;
            color: white;
        }

        .service-actions .btn-delete:hover {
            background: #d32f2f;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show,
        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card, white);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--text-primary, #333);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary, #666);
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--text-primary, #333);
        }

        .modal-form {
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="decoration decoration-1"></div>
            <div class="decoration decoration-2"></div>
            
            <h1>Server Settings</h1>
            <p class="subtitle">Configure your server and application settings</p>
        </header>
        
        <div class="admin-content">
            <div>
                <!-- Settings Subnavigation Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">
                        <i class="fas fa-sliders-h"></i> General
                    </button>
                    <button class="settings-tab" data-tab="appearance">
                        <i class="fas fa-palette"></i> Appearance
                    </button>
                    <button class="settings-tab" data-tab="notifications">
                        <i class="fas fa-bell"></i> Notifications
                    </button>
                    <button class="settings-tab" data-tab="security">
                        <i class="fas fa-shield-alt"></i> Security
                    </button>
                    <button class="settings-tab" data-tab="sso">
                        <i class="fas fa-sign-in-alt"></i> SSO
                    </button>
                    <button class="settings-tab" data-tab="users">
                        <i class="fas fa-users"></i> User Management
                    </button>
                </div>
                
                <!-- General Settings -->
                <section class="settings-section" id="general-tab" data-tab="general">
                    <h2 class="section-title">
                        <i class="fas fa-sliders-h"></i> General Settings
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-globe"></i> Default Language
                            </h3>
                            <p class="setting-description">
                                Set the default language for the interface
                            </p>
                            <div class="form-group">
                                <select id="default-language">
                                    <option value="en">English</option>
                                    <option value="es">Espaol</option>
                                    <option value="fr">Franais</option>
                                    <option value="de">Deutsch</option>
                                    <option value="ja"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" id="save-general">
                            <i class="fas fa-save"></i> Save General Settings
                        </button>
                    </div>
                </section>
                
                <!-- Appearance & Accessibility -->
                <section class="settings-section" id="appearance-tab" data-tab="appearance">
                    <h2 class="section-title">
                        <i class="fas fa-palette"></i> Appearance & Accessibility
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-font"></i> Font Size
                            </h3>
                            <p class="setting-description">
                                Adjust the text size for better readability
                            </p>
                            <div class="form-group">
                                <select id="font-size">
                                    <option value="small">Small</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="large">Large</option>
                                    <option value="extra-large">Extra Large</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-volume-up"></i> Sound Effects
                            </h3>
                            <p class="setting-description">
                                Play sound effects for actions and notifications
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="sound-effects" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Sounds</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-running"></i> Animations
                            </h3>
                            <p class="setting-description">
                                Enable smooth animations and transitions
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="animations" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Animations</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-compact-disc"></i> Reduce Motion
                            </h3>
                            <p class="setting-description">
                                Minimize animations for accessibility
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="reduce-motion">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Reduce Motion</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-palette"></i> Theme
                            </h3>
                            <p class="setting-description">
                                Choose your dashboard theme
                            </p>
                            <div class="form-group">
                                <select id="theme">
                                    <option value="pastel"> Original Pastel (Default)</option>
                                    <option value="cyber"> Sakura (Neon Pink)</option>
                                    <option value="sunset"> Sunset Gradient</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-contrast"></i> High Contrast
                            </h3>
                            <p class="setting-description">
                                Increase contrast for better visibility
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="high-contrast">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable High Contrast</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-calendar"></i> Date Format
                            </h3>
                            <p class="setting-description">
                                Choose how dates are displayed
                            </p>
                            <div class="form-group">
                                <select id="date-format">
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    <option value="MMM DD, YYYY">MMM DD, YYYY</option>
                                    <option value="DD MMM YYYY">DD MMM YYYY</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-chart-bar"></i> Chart Theme
                            </h3>
                            <p class="setting-description">
                                Set the style for data visualization
                            </p>
                            <div class="form-group">
                                <select id="chart-theme">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="auto">Auto (match theme)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Display Options -->
                    <h3 style="margin-top: 40px; margin-bottom: 20px; color: var(--primary); font-size: 1.4rem; display: flex; align-items: center; gap: 10px; border-bottom: 2px solid var(--primary); padding-bottom: 10px;">
                        <i class="fas fa-sliders-h"></i> Display Options
                    </h3>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-border-all"></i> Rounded Corners
                            </h3>
                            <p class="setting-description">
                                Adjust corner radius for elements
                            </p>
                            <div class="form-group">
                                <select id="border-radius">
                                    <option value="sharp">Sharp</option>
                                    <option value="slight">Slight</option>
                                    <option value="moderate" selected>Moderate</option>
                                    <option value="rounded">Rounded</option>
                                    <option value="pill">Pill</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-square"></i> Compact Mode
                            </h3>
                            <p class="setting-description">
                                Reduce spacing and padding
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="compact-mode">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Compact Mode</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" id="save-appearance">
                            <i class="fas fa-save"></i> Save Appearance Settings
                        </button>
                    </div>
                </section>
                
                <!-- Integration & API -->
                <section class="settings-section" id="integration-tab" data-tab="integration">
                    <h2 class="section-title">
                        <i class="fas fa-plug"></i> Integration & API
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-key"></i> API Key
                            </h3>
                            <p class="setting-description">
                                External API access key for integrations
                            </p>
                            <div class="form-group">
                                <input type="password" id="api-key" placeholder="Enter API key" value="">
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-webhook"></i> Webhook URL
                            </h3>
                            <p class="setting-description">
                                URL for receiving webhook notifications
                            </p>
                            <div class="form-group">
                                <input type="url" id="webhook-url" placeholder="https://example.com/webhook" value="">
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-cloud"></i> Cloud Storage
                            </h3>
                            <p class="setting-description">
                                Cloud storage service for backups
                            </p>
                            <div class="form-group">
                                <select id="cloud-provider">
                                    <option value="">None</option>
                                    <option value="aws">Amazon S3</option>
                                    <option value="gcp">Google Cloud</option>
                                    <option value="azure">Azure Blob</option>
                                    <option value="dropbox">Dropbox</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-chart-bar"></i> Analytics
                            </h3>
                            <p class="setting-description">
                                Enable usage analytics and reporting
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="analytics-enabled">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Analytics</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-bell"></i> Push Notifications
                            </h3>
                            <p class="setting-description">
                                Send push notifications to mobile devices
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="push-notifications">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Push Notifications</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="slack-webhook">Slack Webhook URL</label>
                        <input type="url" id="slack-webhook" placeholder="https://hooks.slack.com/services/..." value="">
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-secondary" id="test-integrations">
                            <i class="fas fa-flask"></i> Test Integrations
                        </button>
                        <button class="btn btn-primary" id="save-integrations">
                            <i class="fas fa-save"></i> Save Integration Settings
                        </button>
                    </div>
                </section>
                
                <!-- Advanced Customization -->
                <section class="settings-section" id="customization-tab" data-tab="customization">
                    <h2 class="section-title">
                        <i class="fas fa-paint-brush"></i> Advanced Customization
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-columns"></i> Layout Style
                            </h3>
                            <p class="setting-description">
                                Choose how the dashboard is arranged
                            </p>
                            <div class="form-group">
                                <select id="layout-style">
                                    <option value="grid" selected>Grid Layout</option>
                                    <option value="list">List Layout</option>
                                    <option value="cards">Card Layout</option>
                                    <option value="compact">Compact Layout</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-bell"></i> Notification Style
                            </h3>
                            <p class="setting-description">
                                How notifications appear on screen
                            </p>
                            <div class="form-group">
                                <select id="notification-style">
                                    <option value="toast" selected>Toast Notifications</option>
                                    <option value="banner">Banner Notifications</option>
                                    <option value="modal">Modal Notifications</option>
                                    <option value="none">No Notifications</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-clock"></i> Auto Refresh
                            </h3>
                            <p class="setting-description">
                                Automatically refresh dashboard data
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="auto-refresh" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Auto Refresh</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-palette"></i> Color Scheme
                            </h3>
                            <p class="setting-description">
                                Choose your preferred color palette
                            </p>
                            <div class="form-group">
                                <select id="color-scheme">
                                    <option value="default" selected>Default</option>
                                    <option value="blue">Blue Ocean</option>
                                    <option value="green">Forest Green</option>
                                    <option value="purple">Royal Purple</option>
                                    <option value="orange">Sunset Orange</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-language"></i> Date Format
                            </h3>
                            <p class="setting-description">
                                How dates are displayed
                            </p>
                            <div class="form-group">
                                <select id="date-format">
                                    <option value="MM/DD/YYYY" selected>MM/DD/YYYY</option>
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    <option value="relative">Relative (2 hours ago)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-chart-line"></i> Chart Theme
                            </h3>
                            <p class="setting-description">
                                Theme for performance charts
                            </p>
                            <div class="form-group">
                                <select id="chart-theme">
                                    <option value="light" selected>Light Theme</option>
                                    <option value="dark">Dark Theme</option>
                                    <option value="colorful">Colorful</option>
                                    <option value="minimal">Minimal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="custom-css">Custom CSS</label>
                        <textarea id="custom-css" placeholder="Enter custom CSS rules here..." rows="6"></textarea>
                        <small class="form-help">Add custom CSS to personalize your dashboard appearance</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="dashboard-title">Dashboard Title</label>
                        <input type="text" id="dashboard-title" placeholder="My Server Dashboard" value="">
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-secondary" id="reset-customization">
                            <i class="fas fa-undo"></i> Reset to Defaults
                        </button>
                        <button class="btn btn-primary" id="save-customization">
                            <i class="fas fa-save"></i> Save Customization
                        </button>
                    </div>
                </section>
                
                <!-- Security Settings -->
                <section class="settings-section" id="security-tab" data-tab="security">
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt"></i> Security Settings
                    </h2>
                    
                    <!-- 2FA Enforcement Policy Status -->
                    <div id="twofa-enforcement-config" style="margin-top: 30px; padding: 20px; background: rgba(0, 224, 255, 0.1); border-radius: 15px; border-left: 5px solid var(--neon-blue); margin-bottom: 30px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 15px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-info-circle"></i> 2FA Policy Status
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="padding: 15px; background: white; border-radius: 10px;">
                                <p style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">Enforcement Mode</p>
                                <p id="twofa-enforcement-mode" style="font-weight: 600; font-size: 1.1rem; color: var(--primary);">Loading...</p>
                            </div>
                            <div style="padding: 15px; background: white; border-radius: 10px;">
                                <p style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">Users with 2FA</p>
                                <p id="twofa-users-count" style="font-weight: 600; font-size: 1.1rem; color: var(--neon-blue);">Loading...</p>
                            </div>
                            <div style="padding: 15px; background: white; border-radius: 10px;">
                                <p style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">Grace Period (days)</p>
                                <p id="twofa-grace-expires" style="font-weight: 600; font-size: 1rem; color: #666;">Not set</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-shield-alt"></i> Enforce 2FA for All Users
                            </h3>
                            <p class="setting-description">
                                Require all users to set up two-factor authentication
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="enforce-2fa-all-users">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-users"></i> Admin 2FA Required
                            </h3>
                            <p class="setting-description">
                                Require 2FA only for administrator accounts
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="enforce-2fa-admins-only">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-clock"></i> 2FA Grace Period (days)
                            </h3>
                            <p class="setting-description">
                                Days before 2FA enforcement is mandatory (0 = immediate)
                            </p>
                            <div class="form-group">
                                <input type="number" id="twofa-grace-period" min="0" max="365" value="7" style="max-width: 150px;">
                            </div>
                        </div>
                    </div>

                    <!-- 2FA Configuration (shown when 2FA is enabled) -->
                    <div id="twofa-config" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.5); border-radius: 15px; border-left: 5px solid var(--primary);">
                        <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-shield-alt"></i> Two-Factor Authentication Setup
                        </h3>
                        
                        <div id="twofa-setup" style="display: none;">
                            <p style="color: #666; margin-bottom: 15px;">
                                Scan this QR code with an authenticator app (Google Authenticator, Microsoft Authenticator, Authy, etc.)
                            </p>
                            
                            <div id="qrcode-container" style="text-align: center; margin: 20px 0; padding: 20px; background: white; border-radius: 10px;"></div>
                            
                            <div class="form-group">
                                <label for="twofa-backup-codes">Backup Codes (save in a secure location)</label>
                                <textarea id="twofa-backup-codes" readonly style="background-color: #f5f5f5; color: #333; font-family: monospace; font-size: 0.9rem; min-height: 100px;"></textarea>
                                <small style="color: #999; font-size: 0.85rem; display: block; margin-top: 5px;">Save these codes in a secure location. Each code can be used once if you lose access to your authenticator.</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="twofa-verification-code">Verification Code</label>
                                <input type="text" id="twofa-verification-code" placeholder="000000" maxlength="6" style="font-family: monospace; font-size: 1.2rem; letter-spacing: 2px;">
                                <small style="color: #999; font-size: 0.85rem; display: block; margin-top: 5px;">Enter the 6-digit code from your authenticator to verify setup</small>
                            </div>
                            
                            <button id="verify-twofa-btn" class="btn btn-primary" style="width: 100%; margin-top: 15px;">
                                <i class="fas fa-check"></i> Verify & Enable 2FA
                            </button>
                        </div>
                        
                        <div id="twofa-enabled" style="display: none; text-align: center; padding: 20px; background: rgba(46, 213, 115, 0.1); border-radius: 10px; border: 2px solid #2ed573;">
                            <i class="fas fa-check-circle" style="font-size: 2rem; color: #2ed573; margin-bottom: 10px;"></i>
                            <p style="color: #2ed573; font-weight: 600; margin: 10px 0;">Two-Factor Authentication is Enabled</p>
                            <p style="color: #666; font-size: 0.9rem; margin: 10px 0;">Your account is protected with TOTP-based 2FA</p>
                            <button id="disable-twofa-btn" class="btn btn-secondary" style="width: 100%; margin-top: 15px; background: #ff6b93 !important; color: white !important; border: none !important;">
                                <i class="fas fa-times"></i> Disable 2FA
                            </button>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-primary" id="save-security">
                            <i class="fas fa-save"></i> Save Security Settings
                        </button>
                    </div>
                </section>
                
                <!-- Advanced Security -->
                <section class="settings-section" id="advanced-security-tab" data-tab="security">
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt"></i> Advanced Security
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-clock"></i> Session Timeout
                            </h3>
                            <p class="setting-description">
                                Automatically log out users after inactivity
                            </p>
                            <div class="form-group">
                                <select id="session-timeout">
                                    <option value="900">15 minutes</option>
                                    <option value="1800">30 minutes</option>
                                    <option value="3600" selected>1 hour</option>
                                    <option value="7200">2 hours</option>
                                    <option value="0">Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-users"></i> Max Concurrent Sessions
                            </h3>
                            <p class="setting-description">
                                Limit simultaneous logins per user
                            </p>
                            <div class="form-group">
                                <input type="number" id="max-concurrent-sessions" min="1" max="10" value="3">
                                <span class="input-addon">sessions</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-history"></i> Audit Logging
                            </h3>
                            <p class="setting-description">
                                Log all user actions for security monitoring
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="audit-logging" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Audit Logging</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-lock"></i> Password Policy
                            </h3>
                            <p class="setting-description">
                                Enforce strong password requirements
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="password-policy" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Password Policy</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-keyboard"></i> Login Attempts
                            </h3>
                            <p class="setting-description">
                                Maximum failed login attempts before lockout
                            </p>
                            <div class="form-group">
                                <input type="number" id="max-login-attempts" min="3" max="20" value="5">
                                <span class="input-addon">attempts</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-user-secret"></i> Account Lockout
                            </h3>
                            <p class="setting-description">
                                Duration of account lockout after failed attempts
                            </p>
                            <div class="form-group">
                                <select id="lockout-duration">
                                    <option value="900">15 minutes</option>
                                    <option value="1800">30 minutes</option>
                                    <option value="3600" selected>1 hour</option>
                                    <option value="7200">2 hours</option>
                                    <option value="86400">24 hours</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-ban"></i> IP Whitelist
                            </h3>
                            <p class="setting-description">
                                Restrict access to specific IP addresses
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="ip-whitelist">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- IP Whitelist Configuration (shown when IP Whitelist is enabled in Advanced Security) -->
                    <div id="ip-whitelist-config" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.5); border-radius: 15px; border-left: 5px solid var(--primary);">
                        <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-list"></i> IP Address Management
                        </h3>
                        
                        <div class="form-group">
                            <label for="allowed-ips">Allowed IP Addresses</label>
                            <textarea id="allowed-ips" placeholder="Enter one IP per line" style="background-color: white; border: 1px solid #ddd; padding: 10px; border-radius: 8px; font-family: monospace; min-height: 120px;">192.168.1.0/24</textarea>
                            <small style="color: #999; font-size: 0.85rem; display: block; margin-top: 5px;">Restrict access to specific IP addresses (one per line, supports CIDR notation)</small>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-primary" id="save-advanced-security">
                            <i class="fas fa-save"></i> Save Advanced Security Settings
                        </button>
                    </div>
                </section>
                
                <!-- SSO Settings -->
                <section class="settings-section" id="sso-tab" data-tab="sso">
                    <h2 class="section-title">
                        <i class="fas fa-sign-in-alt"></i> Single Sign-On (SSO)
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-sign-in-alt"></i> Enable SSO / OIDC Login
                            </h3>
                            <p class="setting-description">
                                Enable Single Sign-On using OpenID Connect
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="sso-enabled">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SSO Configuration (shown when SSO is enabled) -->
                    <div id="sso-config" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.5); border-radius: 15px; border-left: 5px solid var(--primary);">
                        <h3 style="color: var(--primary); margin-bottom: 20px; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-cog"></i> OIDC Configuration
                        </h3>
                        
                        <div class="form-group">
                            <label for="sso-issuer-url">Issuer URL</label>
                            <input type="url" id="sso-issuer-url" placeholder="https://your-idp.com/realms/yourrealm">
                            <small style="color: #999; font-size: 0.85rem; display: block; margin-top: 5px;">The OIDC discovery URL (e.g., Keycloak, Authentik, Auth0)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="sso-client-id">Client ID</label>
                            <input type="text" id="sso-client-id" placeholder="your-client-id">
                        </div>
                        
                        <div class="form-group">
                            <label for="sso-client-secret">Client Secret</label>
                            <input type="password" id="sso-client-secret" placeholder="your-client-secret">
                        </div>
                        
                        <div class="form-group">
                            <label for="sso-redirect-uri">Redirect URI (Read-only)</label>
                            <input type="text" id="sso-redirect-uri" readonly value="" style="background-color: #f5f5f5; cursor: not-allowed;">
                            <small style="color: #999; font-size: 0.85rem; display: block; margin-top: 5px;">Configure this URL in your OIDC provider</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="sso-scopes">Scopes</label>
                            <input type="text" id="sso-scopes" placeholder="openid profile email" value="openid profile email">
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-primary" id="save-sso">
                            <i class="fas fa-save"></i> Save SSO Settings
                        </button>
                    </div>
                </section>
                
                <!-- Alerts Configuration -->
                <section class="settings-section" id="notifications-tab" data-tab="notifications">
                    <h2 class="section-title">
                        <i class="fas fa-bell"></i> Notifications & Alerts
                    </h2>
                    
                    <!-- Communication Methods -->
                    <h3 style="margin-top: 30px; margin-bottom: 20px; color: var(--primary); font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-share-alt"></i> Communication Methods
                    </h3>
                    
                    <p style="margin-bottom: 20px; color: var(--text); font-size: 0.95rem;">
                        Enable notification delivery methods for application alerts and user notifications.
                    </p>
                    
                    <div class="settings-grid" style="margin-bottom: 30px;">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fab fa-discord"></i> Discord Notifications
                            </h3>
                            <p class="setting-description">
                                Send notifications to Discord webhook
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="discord-enabled">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Discord</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-envelope"></i> Email Notifications
                            </h3>
                            <p class="setting-description">
                                Send notifications via SMTP email
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="smtp-enabled">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable SMTP</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Discord Configuration -->
                    <div id="discord-config" style="display: none; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px; color: var(--primary); font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fab fa-discord"></i> Discord Configuration
                        </h3>

                        <p style="margin-bottom: 20px; color: var(--text); font-size: 0.95rem;">
                            Send real-time notifications to your Discord server. Create a webhook in your Discord server settings and paste the URL below.
                        </p>
                        
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fab fa-discord"></i> Webhook URL
                                </h3>
                                <p class="setting-description">
                                    Discord server webhook for notifications
                                </p>
                                <div class="form-group">
                                    <label for="discord-webhook">Discord Webhook URL</label>
                                    <input type="text" id="discord-webhook" placeholder="https://discord.com/api/webhooks/..." value="">
                                    <small>How to get: Discord Server  Settings  Integrations  Webhooks  New Webhook  Copy Webhook URL</small>
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fas fa-user-circle"></i> Bot Username
                                </h3>
                                <p class="setting-description">
                                    Name to display in Discord messages
                                </p>
                                <div class="form-group">
                                    <label for="discord-username">Bot Username</label>
                                    <input type="text" id="discord-username" placeholder="Landio Bot" value="Landio Bot">
                                    <small>The name shown on notification messages in Discord</small>
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fas fa-flask"></i> Test Connection
                                </h3>
                                <p class="setting-description">
                                    Send a test message to verify webhook is working
                                </p>
                                <button class="btn btn-primary" id="test-discord-btn" style="width: 100%; margin-top: 15px;">
                                    <i class="fab fa-discord"></i> Send Test Message
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SMTP Configuration -->
                    <div id="smtp-config" style="display: none; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px; color: var(--primary); font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-envelope"></i> SMTP Configuration
                        </h3>
                        
                        <p style="margin-bottom: 20px; color: var(--text); font-size: 0.95rem;">
                            Configure email delivery for application alerts and user notifications (2FA changes, password resets, account modifications, etc.)
                        </p>
                        
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fas fa-server"></i> SMTP Server
                                </h3>
                                <p class="setting-description">
                                    Email server address and port
                                </p>
                                <div class="form-group">
                                    <label for="smtp-server">Server Address</label>
                                    <input type="text" id="smtp-server" placeholder="smtp.gmail.com" value="">
                                </div>
                                <div class="form-group">
                                    <label for="smtp-port">Port</label>
                                    <input type="number" id="smtp-port" placeholder="587" min="1" max="65535" value="587">
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fas fa-user-circle"></i> SMTP Credentials
                                </h3>
                                <p class="setting-description">
                                    Login credentials for SMTP server
                                </p>
                                <div class="form-group">
                                    <label for="smtp-username">Email Address</label>
                                    <input type="email" id="smtp-username" placeholder="your-email@gmail.com" value="">
                                </div>
                                <div class="form-group">
                                    <label for="smtp-password">Password / App Password</label>
                                    <input type="password" id="smtp-password" placeholder="Enter password" value="">
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fas fa-lock"></i> Encryption
                                </h3>
                                <p class="setting-description">
                                    Enable TLS/SSL encryption for SMTP
                                </p>
                                <div class="form-group">
                                    <label class="toggle">
                                        <input type="checkbox" id="smtp-use-tls">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="toggle-label">Use TLS/SSL Encryption</span>
                                </div>
                                <button class="btn btn-primary" id="save-smtp-config-btn" style="width: 100%; margin-top: 15px;">
                                    <i class="fas fa-save"></i> Save SMTP Configuration
                                </button>
                            </div>
                            
                            <div class="setting-card">
                                <h3 class="setting-name">
                                    <i class="fas fa-flask"></i> Test Configuration
                                </h3>
                                <p class="setting-description">
                                    Send a test email to verify SMTP is working
                                </p>
                                <div class="form-group">
                                    <label for="smtp-test-recipient">Test Email Address</label>
                                    <input type="email" id="smtp-test-recipient" placeholder="your-email@example.com" value="">
                                    <small>Where should we send the test email?</small>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    <button class="btn btn-primary" id="test-smtp-btn" style="flex: 1;">
                                        <i class="fas fa-paper-plane"></i> Send Test Email
                                    </button>
                                </div>
                                <div id="smtp-test-result" style="margin-top: 15px; display: none; padding: 12px; border-radius: 4px; font-size: 0.9rem;">
                                    <!-- Result message will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enable Event Notifications Section -->
                    <div id="notification-events-section" style="display: none;">
                    <h3 style="margin-top: 40px; margin-bottom: 20px; color: var(--primary); font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-bell"></i> Enable Event Notifications
                    </h3>
                    
                    <p style="margin-bottom: 20px; color: var(--text); font-size: 0.95rem;">
                        Choose which types of events should trigger notifications:
                    </p>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-cog"></i> Application Notifications
                            </h3>
                            <p class="setting-description">
                                Enable notifications for application events
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="enable-app-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable Application Notifications</span>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-users"></i> User Notifications
                            </h3>
                            <p class="setting-description">
                                Enable notifications for user-related events
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="enable-user-notifications" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable User Notifications</span>
                            </div>
                        </div>
                    </div>
                    </div>
                    
                    <!-- Application Notifications Section (Conditional) -->
                    <div id="application-notifications-section" style="display: none;">
                    <h3 style="margin-top: 40px; margin-bottom: 20px; color: var(--primary); font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-cog"></i> Application Notifications
                    </h3>
                    
                    <p style="margin-bottom: 20px; color: var(--text); font-size: 0.95rem;">
                        Select which application events should trigger notifications:
                    </p>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-sign-in-alt"></i> User Login
                            </h3>
                            <p class="setting-description">
                                Notify when users log in to the system
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-login" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="login" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-sign-out-alt"></i> User Logout
                            </h3>
                            <p class="setting-description">
                                Notify when users log out
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-logout">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="logout" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-play-circle"></i> Application Start
                            </h3>
                            <p class="setting-description">
                                Notify when application starts
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-app-start" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="app-start" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-stop-circle"></i> Application Stop
                            </h3>
                            <p class="setting-description">
                                Notify when application stops
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-app-stop" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="app-stop" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-sync-alt"></i> Application Restart
                            </h3>
                            <p class="setting-description">
                                Notify when application restarts
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-app-restart" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="app-restart" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-exclamation-triangle"></i> Errors
                            </h3>
                            <p class="setting-description">
                                Notify when application errors occur
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-errors" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="errors" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                    </div>
                    </div>
                    
                    <!-- User Notifications Section (Conditional) -->
                    <div id="user-notifications-section" style="display: none;">
                    <h3 style="margin-top: 40px; margin-bottom: 20px; color: var(--primary); font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-user"></i> User Notifications
                    </h3>
                    
                    <p style="margin-bottom: 20px; color: var(--text); font-size: 0.95rem;">
                        Select which user-related events should trigger notifications:
                    </p>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-lock"></i> Security Alert
                            </h3>
                            <p class="setting-description">
                                Notify on security-related events
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-security" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="security" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                        
                        <div class="setting-card">
                            <h3 class="setting-name">
                                <i class="fas fa-user-edit"></i> User Activity
                            </h3>
                            <p class="setting-description">
                                Notify on user account changes
                            </p>
                            <div class="form-group">
                                <label class="toggle">
                                    <input type="checkbox" id="notify-user-activity">
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Enable</span>
                            </div>
                            <button class="btn btn-secondary preview-message-btn" data-event="user-activity" style="width: 100%; margin-top: 10px; font-size: 0.9rem;">
                                <i class="fas fa-eye"></i> Preview Message
                            </button>
                        </div>
                    </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" id="save-notifications">
                            <i class="fas fa-save"></i> Save Notification Settings
                        </button>
                    </div>
                </section>
                
                <!-- Backup & Restore -->
            </div>
            
            <!-- System Information Sidebar -->
            <div>
                <section class="settings-section">
                    <h2 class="section-title">
                        <i class="fas fa-info-circle"></i> System Info
                    </h2>
                    
                    <div class="system-info">
                        <div class="info-card">
                            <i class="fas fa-microchip" style="color: var(--primary); font-size: 1.5rem;"></i>
                            <div class="info-value" id="cpu-usage">12%</div>
                            <div class="info-label">CPU Usage</div>
                        </div>
                        
                        <div class="info-card">
                            <i class="fas fa-memory" style="color: var(--primary); font-size: 1.5rem;"></i>
                            <div class="info-value" id="memory-usage">64%</div>
                            <div class="info-label">Memory Usage</div>
                        </div>
                        
                        <div class="info-card">
                            <i class="fas fa-hdd" style="color: var(--primary); font-size: 1.5rem;"></i>
                            <div class="info-value" id="disk-usage">42%</div>
                            <div class="info-label">Disk Usage</div>
                        </div>
                        
                        <div class="info-card">
                            <i class="fas fa-network-wired" style="color: var(--primary); font-size: 1.5rem;"></i>
                            <div class="info-value" id="uptime">15d</div>
                            <div class="info-label">Uptime</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <div class="status status-online">
                            <i class="fas fa-circle"></i> All Systems Operational
                        </div>
                    </div>
                </section>
                
                <section class="settings-section">
                    <h2 class="section-title">
                        <i class="fas fa-tools"></i> Maintenance
                    </h2>
                    
                    <div class="buttons">
                        <button class="btn btn-secondary" id="clear-cache">
                            <i class="fas fa-broom"></i> Clear Cache
                        </button>
                        <button class="btn btn-danger" id="restart-services">
                            <i class="fas fa-redo"></i> Restart Services
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" style="width: 100%;" id="save-settings">
                            <i class="fas fa-save"></i> Save All Settings
                        </button>
                    </div>
                </section>

                <!-- User Management Section -->
                <section class="settings-section" id="users-tab" data-tab="users">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i> User Management
                        <span class="btn btn-primary btn-small" id="add-user-btn">
                            <i class="fas fa-plus"></i> Add User
                        </span>
                    </h2>
                    
                    <div class="user-controls">
                        <div class="search-box">
                            <input type="text" id="user-search-input" class="search-input" placeholder="Search users..." aria-label="Search users">
                            <button class="search-btn" title="Search users">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <select class="filter-select" id="role-filter" title="Filter by role">
                            <option value="">All Roles</option>
                            <option value="admin">Admin</option>
                            <option value="poweruser">Power User</option>
                            <option value="user">User</option>
                        </select>
                        <select class="filter-select" id="status-filter" title="Filter by status">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="users-grid" id="users-container">
                        <!-- Users will be dynamically added here -->
                    </div>
                    
                    <div class="empty-state" id="users-empty-state" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <h3>No users found</h3>
                        <p>Click the "Add User" button to create a new user!</p>
                    </div>
                </section>
                
                <!-- Add User Modal -->
                <div class="modal-overlay" id="add-user-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2><i class="fas fa-user-plus"></i> <span id="modal-title">Add New User</span></h2>
                            <button type="button" class="modal-close" id="user-modal-close-btn" title="Close modal">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <form id="user-form" class="modal-form">
                            <div class="form-group">
                                <label for="user-name">Full Name</label>
                                <input type="text" id="user-name" placeholder="Enter full name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="user-email">Email Address</label>
                                <input type="email" id="user-email" placeholder="user@example.com" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="user-password">Password</label>
                                <div class="password-input-group">
                                    <input type="text" id="user-password" placeholder="Generated password" required readonly>
                                    <button type="button" id="generate-password-btn" class="btn btn-secondary" title="Generate a random password">
                                        <i class="fas fa-refresh"></i> Generate
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="user-role">Role</label>
                                <select id="user-role" required>
                                    <option value="user">User</option>
                                    <option value="poweruser">Power User</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="user-status">Status</label>
                                <select id="user-status" required>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="user-permissions">Permissions (Optional)</label>
                                <textarea id="user-permissions" placeholder="Describe user permissions..." rows="3"></textarea>
                            </div>
                            
                            <div class="modal-buttons">
                                <button type="submit" class="btn btn-primary" id="user-submit-btn">
                                    <i class="fas fa-user-plus"></i> Add User
                                </button>
                                <button type="button" class="btn btn-secondary" id="user-cancel-btn">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                        
                        <div class="modal-footer">
                            <h3><i class="fas fa-info-circle"></i> User Roles</h3>
                            <p><strong>Admin:</strong> Full access to all settings and user management</p>
                            <p><strong>Power User:</strong> Can manage services and view logs</p>
                            <p><strong>User:</strong> Can access services but not change settings</p>
                        </div>
                    </div>
                </div>

                <!-- Two-Factor Authentication Modal -->
                <div class="modal-overlay" id="twofa-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2><i class="fas fa-shield-alt"></i> Two-Factor Authentication</h2>
                            <button type="button" class="modal-close" id="twofa-modal-close-btn" title="Close modal">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div class="modal-body">
                            <!-- Check 2FA Status -->
                            <div id="twofa-check-status">
                                <p>Checking your 2FA status...</p>
                            </div>

                            <!-- 2FA Not Enabled Section -->
                            <div id="twofa-not-enabled" style="display: none;">
                                <h3>Enable Two-Factor Authentication</h3>
                                <p style="color: #666; margin-bottom: 20px;">Protect your account with a second verification factor using an authenticator app.</p>

                                <div id="twofa-setup-section" style="text-align: center; padding: 20px; background: rgba(0, 224, 255, 0.1); border-radius: 10px; margin-bottom: 20px;">
                                    <p style="color: #666; margin-bottom: 15px;">
                                        <strong>Step 1:</strong> Scan this QR code with your authenticator app<br>
                                        (Google Authenticator, Microsoft Authenticator, Authy, etc.)
                                    </p>
                                    <div id="twofa-qr-code" style="margin: 20px 0; padding: 20px; background: white; border-radius: 10px; display: inline-block;"></div>
                                    <p style="color: #999; font-size: 0.9rem; margin-top: 15px;">
                                        Can't scan? Enter this code manually:<br>
                                        <code id="twofa-manual-code" style="background: #f5f5f5; padding: 8px 12px; border-radius: 5px; display: inline-block; margin-top: 10px; font-family: monospace; font-size: 1.1rem; letter-spacing: 2px;"></code>
                                    </p>
                                </div>

                                <div class="form-group">
                                    <label for="twofa-verify-code">Enter 6-digit code from your app:</label>
                                    <input type="text" id="twofa-verify-code" placeholder="000000" maxlength="6" inputmode="numeric" style="text-align: center; font-size: 1.2rem; letter-spacing: 3px; font-family: monospace;">
                                </div>

                                <div class="form-group" id="twofa-backup-codes-display" style="display: none; background: rgba(255, 107, 107, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #ff6b6b;">
                                    <label>Backup Codes (save these in a safe place):</label>
                                    <textarea id="twofa-backup-codes-text" readonly style="background: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.9rem; min-height: 80px; margin-top: 10px;"></textarea>
                                    <small style="color: #999; display: block; margin-top: 10px;">Each code can be used once if you lose access to your authenticator app</small>
                                </div>

                                <div class="modal-buttons">
                                    <button type="button" class="btn btn-primary" id="twofa-verify-btn">
                                        <i class="fas fa-check"></i> Verify & Enable 2FA
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="twofa-cancel-btn">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>

                            <!-- 2FA Enabled Section -->
                            <div id="twofa-already-enabled" style="display: none;">
                                <div style="text-align: center; padding: 30px; background: rgba(46, 213, 115, 0.1); border-radius: 10px; border: 2px solid #2ed573;">
                                    <i class="fas fa-check-circle" style="font-size: 3rem; color: #2ed573; margin-bottom: 15px;"></i>
                                    <h3 style="color: #2ed573; margin: 10px 0;">2FA is Enabled</h3>
                                    <p style="color: #666; margin: 10px 0;">Your account is protected with two-factor authentication.</p>
                                </div>

                                <div style="margin-top: 20px;">
                                    <h4>Your Options:</h4>
                                    <button type="button" class="btn btn-secondary" id="twofa-view-backup-btn" style="width: 100%; margin-bottom: 10px;">
                                        <i class="fas fa-list"></i> View Backup Codes
                                    </button>
                                    <button type="button" class="btn btn-danger" id="twofa-disable-btn" style="width: 100%;">
                                        <i class="fas fa-trash"></i> Disable 2FA
                                    </button>
                                </div>

                                <div id="twofa-backup-codes-view" style="display: none; margin-top: 20px; padding: 15px; background: rgba(255, 107, 107, 0.1); border-radius: 10px; border-left: 4px solid #ff6b6b;">
                                    <p style="color: #666; margin-bottom: 10px;">Your backup codes:</p>
                                    <textarea id="twofa-backup-codes-view-text" readonly style="background: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.9rem; width: 100%; min-height: 100px;"></textarea>
                                    <small style="color: #999; display: block; margin-top: 10px;">Keep these codes in a safe place. Each can be used once to sign in if you lose your authenticator device.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Server Dashboard</p>
        </footer>
    </div>

    <script>
        // User Management Variables
        let users = [];
        let editingUserId = null;

        // Initialize user management when Users tab is active
        async function initUserManagement() {
            try {
                users = await window.Api.getUsers();
                renderUsers();
                setupUserManagementEventListeners();
            } catch (error) {
                console.error('Failed to load users:', error);
                showNotification('Failed to load users: ' + error.message, 'error');
            }
        }

        // Render users to the grid
        function renderUsers() {
            const usersContainer = document.getElementById('users-container');
            const emptyState = document.getElementById('users-empty-state');
            const searchInput = document.getElementById('user-search-input');
            const roleFilter = document.getElementById('role-filter');
            const statusFilter = document.getElementById('status-filter');
            
            if (!usersContainer) return;
            
            usersContainer.innerHTML = '';
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const roleFilterValue = roleFilter ? roleFilter.value : '';
            const statusFilterValue = statusFilter ? statusFilter.value : '';
            
            let filteredUsers = users.filter(user => {
                const matchesSearch = user.name.toLowerCase().includes(searchTerm) || 
                                     user.email.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilterValue || user.role === roleFilterValue;
                const matchesStatus = !statusFilterValue || 
                    (statusFilterValue === 'active' ? user.is_active : !user.is_active);
                
                return matchesSearch && matchesRole && matchesStatus;
            });
            
            if (filteredUsers.length === 0) {
                if (emptyState) emptyState.style.display = 'block';
                return;
            }
            
            if (emptyState) emptyState.style.display = 'none';
            
            filteredUsers.forEach(user => {
                const statusClass = user.is_active ? 'status-active' : 'status-inactive';
                const statusIcon = user.is_active ? 'fa-check-circle' : 'fa-times-circle';
                const statusText = user.is_active ? 'Active' : 'Inactive';
                
                const lastLogin = user.last_login ? new Date(user.last_login).toLocaleString() : 'Never';
                const lastActivity = user.last_activity ? new Date(user.last_activity).toLocaleString() : 'Never';
                const loginCount = user.login_count || 0;
                const isOnline = user.session_start ? 'online' : 'offline';
                const onlineIcon = user.session_start ? 'fa-circle' : 'fa-circle-o';
                const has2FA = user.twoFactorEnabled ? true : false;
                const twoFAIcon = has2FA ? 'fa-shield-alt' : 'fa-shield';
                const twoFAClass = has2FA ? 'tfa-enabled' : 'tfa-disabled';
                const twoFAText = has2FA ? '2FA Enabled' : '2FA Disabled';
                
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                userCard.innerHTML = `
                    <h3 class="user-name">${user.name}</h3>
                    <div class="user-email">${user.email}</div>
                    <div class="user-role role-${user.role}">${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</div>
                    <div class="user-status ${statusClass}">
                        <i class="fas ${statusIcon}"></i> ${statusText}
                    </div>
                    <div class="user-2fa-status ${twoFAClass}">
                        <i class="fas ${twoFAIcon}"></i> ${twoFAText}
                    </div>
                    <div class="user-activity">
                        <div class="activity-item">
                            <i class="fas ${onlineIcon} ${isOnline}"></i> 
                            <span class="activity-label">Status:</span> 
                            <span class="activity-value">${isOnline.charAt(0).toUpperCase() + isOnline.slice(1)}</span>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-sign-in-alt"></i> 
                            <span class="activity-label">Last Login:</span> 
                            <span class="activity-value">${lastLogin}</span>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-clock"></i> 
                            <span class="activity-label">Last Activity:</span> 
                            <span class="activity-value">${lastActivity}</span>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-tachometer-alt"></i> 
                            <span class="activity-label">Login Count:</span> 
                            <span class="activity-value">${loginCount}</span>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-secondary btn-small edit-user-btn" data-id="${user.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn ${has2FA ? 'btn-warning' : 'btn-secondary'} btn-small reset-2fa-btn" data-id="${user.id}" title="${has2FA ? 'Reset 2FA for this user' : 'User has not enabled 2FA'}" ${!has2FA ? 'disabled' : ''}>
                            <i class="fas fa-shield-alt"></i> ${has2FA ? 'Reset 2FA' : 'No 2FA'}
                        </button>
                        <button class="btn btn-danger btn-small delete-user-btn" data-id="${user.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                usersContainer.appendChild(userCard);
            });
        }

        // Generate secure random password
        function generatePassword(length = 12) {
            const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const lowercase = 'abcdefghijklmnopqrstuvwxyz';
            const numbers = '0123456789';
            const symbols = '!@#$%^&*-_=+';
            const allChars = uppercase + lowercase + numbers + symbols;
            
            let password = '';
            password += uppercase[Math.floor(Math.random() * uppercase.length)];
            password += lowercase[Math.floor(Math.random() * lowercase.length)];
            password += numbers[Math.floor(Math.random() * numbers.length)];
            password += symbols[Math.floor(Math.random() * symbols.length)];
            
            for (let i = password.length; i < length; i++) {
                password += allChars[Math.floor(Math.random() * allChars.length)];
            }
            
            return password.split('').sort(() => Math.random() - 0.5).join('');
        }

        // Set up user management event listeners
        function setupUserManagementEventListeners() {
            const addUserBtn = document.getElementById('add-user-btn');
            const userModalCloseBtn = document.getElementById('user-modal-close-btn');
            const userCancelBtn = document.getElementById('user-cancel-btn');
            const addUserModal = document.getElementById('add-user-modal');
            const userForm = document.getElementById('user-form');
            const generatePasswordBtn = document.getElementById('generate-password-btn');
            const searchInput = document.getElementById('user-search-input');
            const roleFilter = document.getElementById('role-filter');
            const statusFilter = document.getElementById('status-filter');
            const usersContainer = document.getElementById('users-container');
            
            if (addUserBtn) {
                addUserBtn.addEventListener('click', function() {
                    openAddUserModal();
                });
            }
            
            if (userModalCloseBtn) {
                userModalCloseBtn.addEventListener('click', closeAddUserModal);
            }
            
            if (userCancelBtn) {
                userCancelBtn.addEventListener('click', closeAddUserModal);
            }
            
            if (addUserModal) {
                addUserModal.addEventListener('click', function(e) {
                    if (e.target === addUserModal) {
                        closeAddUserModal();
                    }
                });
            }
            
            if (userForm) {
                userForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('user-name').value;
                    const email = document.getElementById('user-email').value;
                    const password = document.getElementById('user-password').value;
                    const role = document.getElementById('user-role').value;
                    const isActive = document.getElementById('user-status').value === 'active';
                    
                    if (editingUserId) {
                        await updateUser(editingUserId, name, email, role, isActive);
                    } else {
                        await addUser(name, email, password, role, isActive);
                    }
                });
            }
            
            if (generatePasswordBtn) {
                generatePasswordBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const generatedPassword = generatePassword();
                    document.getElementById('user-password').value = generatedPassword;
                });
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', renderUsers);
            }
            
            if (roleFilter) {
                roleFilter.addEventListener('change', renderUsers);
            }
            
            if (statusFilter) {
                statusFilter.addEventListener('change', renderUsers);
            }
            
            if (usersContainer) {
                usersContainer.addEventListener('click', function(e) {
                    if (e.target.classList.contains('edit-user-btn') || 
                        e.target.parentElement.classList.contains('edit-user-btn')) {
                        const btn = e.target.classList.contains('edit-user-btn') ? e.target : e.target.parentElement;
                        const id = btn.getAttribute('data-id');
                        editUser(id);
                    }
                    
                    if (e.target.classList.contains('delete-user-btn') || 
                        e.target.parentElement.classList.contains('delete-user-btn')) {
                        const btn = e.target.classList.contains('delete-user-btn') ? e.target : e.target.parentElement;
                        const id = btn.getAttribute('data-id');
                        deleteUser(id);
                    }
                    
                    if (e.target.classList.contains('reset-2fa-btn') || 
                        e.target.parentElement.classList.contains('reset-2fa-btn')) {
                        const btn = e.target.classList.contains('reset-2fa-btn') ? e.target : e.target.parentElement;
                        if (btn.disabled) return; // Don't process if button is disabled
                        const id = btn.getAttribute('data-id');
                        resetUser2FA(id);
                    }
                });
            }
        }

        // Setup 2FA Modal Event Listeners
        function setupTwoFAModalEventListeners() {
            const twoFAModal = document.getElementById('twofa-modal');
            const twoFAModalCloseBtn = document.getElementById('twofa-modal-close-btn');
            const twoFACancelBtn = document.getElementById('twofa-cancel-btn');
            const twoFAVerifyBtn = document.getElementById('twofa-verify-btn');
            const twoFADisableBtn = document.getElementById('twofa-disable-btn');
            const twoFAViewBackupBtn = document.getElementById('twofa-view-backup-btn');

            if (twoFAModalCloseBtn) {
                twoFAModalCloseBtn.addEventListener('click', closeTwoFactorModal);
            }

            if (twoFACancelBtn) {
                twoFACancelBtn.addEventListener('click', closeTwoFactorModal);
            }

            if (twoFAModal) {
                twoFAModal.addEventListener('click', function(e) {
                    if (e.target === twoFAModal) {
                        closeTwoFactorModal();
                    }
                });
            }

            if (twoFAVerifyBtn) {
                twoFAVerifyBtn.addEventListener('click', async function() {
                    const code = document.getElementById('twofa-verify-code').value;
                    if (!code || code.length !== 6) {
                        showNotification('Please enter a valid 6-digit code', 'error');
                        return;
                    }
                    await verifyAndEnableTwoFA(code);
                });
            }

            if (twoFADisableBtn) {
                twoFADisableBtn.addEventListener('click', async function() {
                    if (confirm('Are you sure you want to disable 2FA? Your account will be less secure.')) {
                        await disableTwoFA();
                    }
                });
            }

            if (twoFAViewBackupBtn) {
                twoFAViewBackupBtn.addEventListener('click', function() {
                    const backupView = document.getElementById('twofa-backup-codes-view');
                    if (backupView) {
                        backupView.style.display = backupView.style.display === 'none' ? 'block' : 'none';
                    }
                });
            }
        }

        async function verifyAndEnableTwoFA(code) {
            try {
                const response = await fetch('/api/2fa/verify-setup', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: code,
                        secret: window.currentTwoFASecret
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Verification failed');
                }

                const data = await response.json();
                if (data.backupCodes) {
                    // Show backup codes
                    const backupDisplay = document.getElementById('twofa-backup-codes-display');
                    const backupText = document.getElementById('twofa-backup-codes-text');
                    if (backupDisplay && backupText) {
                        backupText.value = data.backupCodes.join('\n');
                        backupDisplay.style.display = 'block';
                    }
                    showNotification('2FA enabled successfully! Please save your backup codes.', 'success');
                } else {
                    showNotification('2FA enabled successfully!', 'success');
                    setTimeout(closeTwoFactorModal, 1000);
                }
            } catch (error) {
                console.error('Error verifying 2FA:', error);
                showNotification('Failed to verify code: ' + error.message, 'error');
            }
        }

        async function disableTwoFA() {
            try {
                const response = await fetch('/api/2fa/disable', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to disable 2FA');
                }

                showNotification('2FA has been disabled', 'success');
                closeTwoFactorModal();
            } catch (error) {
                console.error('Error disabling 2FA:', error);
                showNotification('Failed to disable 2FA: ' + error.message, 'error');
            }
        }

        function openAddUserModal() {
            resetUserForm();
            document.getElementById('user-password').value = generatePassword();
            const modal = document.getElementById('add-user-modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeAddUserModal() {
            const modal = document.getElementById('add-user-modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
            resetUserForm();
        }

        function resetUserForm() {
            const userForm = document.getElementById('user-form');
            if (userForm) userForm.reset();
            editingUserId = null;
            const submitBtn = document.getElementById('user-submit-btn');
            const modalTitle = document.getElementById('modal-title');
            if (submitBtn) submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Add User';
            if (modalTitle) modalTitle.textContent = 'Add New User';
        }

        async function addUser(name, email, password, role, isActive) {
            try {
                await window.Api.createUser({
                    name,
                    email,
                    password,
                    role,
                    is_active: isActive
                });

                users = await window.Api.getUsers();
                renderUsers();
                showNotification('User added successfully!');
                closeAddUserModal();
            } catch (error) {
                showNotification('Error adding user: ' + error.message, 'error');
            }
        }

        async function updateUser(id, name, email, role, isActive) {
            try {
                await window.Api.updateUser(id, {
                    name,
                    email,
                    role,
                    is_active: isActive
                });

                users = await window.Api.getUsers();
                renderUsers();
                showNotification('User updated successfully!');
                closeAddUserModal();
            } catch (error) {
                showNotification('Error updating user: ' + error.message, 'error');
            }
        }

        async function deleteUser(id) {
            const user = users.find(u => u.id === parseInt(id));
            
            if (user && confirm(`Are you sure you want to delete ${user.name}? This action cannot be undone.`)) {
                try {
                    await window.Api.deleteUser(id);
                    users = await window.Api.getUsers();
                    renderUsers();
                    showNotification('User deleted successfully!');
                } catch (error) {
                    showNotification('Error deleting user: ' + error.message, 'error');
                }
            }
        }

        async function resetUser2FA(id) {
            const user = users.find(u => u.id === parseInt(id));
            
            if (user && confirm(`Are you sure you want to reset 2FA for ${user.name}? They will need to re-enroll in 2FA.`)) {
                try {
                    const response = await fetch(`/api/users/${id}/reset-2fa`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to reset 2FA');
                    }
                    
                    const result = await response.json();
                    users = await window.Api.getUsers();
                    renderUsers();
                    showNotification(result.message || '2FA reset successfully!');
                } catch (error) {
                    showNotification('Error resetting 2FA: ' + error.message, 'error');
                }
            }
        }

        function editUser(id) {
            const user = users.find(u => u.id === parseInt(id));
            
            if (user) {
                document.getElementById('user-name').value = user.name;
                document.getElementById('user-email').value = user.email;
                document.getElementById('user-role').value = user.role;
                document.getElementById('user-status').value = user.is_active ? 'active' : 'inactive';
                document.getElementById('user-permissions').value = user.permissions || '';
                
                editingUserId = id;
                const submitBtn = document.getElementById('user-submit-btn');
                const modalTitle = document.getElementById('modal-title');
                if (submitBtn) submitBtn.innerHTML = '<i class="fas fa-save"></i> Update User';
                if (modalTitle) modalTitle.textContent = 'Edit User';
                
                openAddUserModal();
            }
        }

        // Settings management functionality
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            serverName: 'My Awesome Server',
            defaultLanguage: 'en',
            theme: 'anime',
            requireLogin: true,
            twoFactor: false,
            ipWhitelist: false,
            allowedIPs: '192.168.1.0/24',
            autoBackup: true,
            cloudBackup: false,
            // New accessibility and appearance settings
            fontSize: 'medium',
            highContrast: false,
            soundEffects: true,
            animations: true,
            reduceMotion: false,
            // Performance settings
            cacheDuration: 1800,
            compression: true,
            lazyLoading: true,
            monitoringInterval: 5000,
            memoryOptimization: true,
            preloading: false,
            maxConcurrentRequests: 5,
            // Integration settings
            apiKey: '',
            webhookUrl: '',
            smtpServer: '',
            cloudProvider: '',
            analyticsEnabled: false,
            pushNotifications: false,
            slackWebhook: '',
            discordWebhook: '',
            discordEnabled: false,
            discordUsername: 'Landio Bot',
            // SMTP Configuration
            smtpEnabled: true,
            smtpServer: '',
            smtpPort: 587,
            smtpUsername: '',
            smtpPassword: '',
            smtpUseTls: true,
            alertEmail: '',
            alertCcEmail: '',
            emailAlerts: true,
            emailUserNotifications: true,
            alertRecipientType: 'admins',
            selectedAlertAdmins: [],
            // Notification Triggers
            notifyLogin: true,
            notifyLogout: false,
            notifyAppStart: true,
            notifyAppStop: true,
            notifyAppRestart: true,
            notifyErrors: true,
            notifySecurity: true,
            notifyUserActivity: false,
            // Advanced customization settings
            layoutStyle: 'grid',
            notificationStyle: 'toast',
            autoRefresh: true,
            dateFormat: 'MM/DD/YYYY',
            chartTheme: 'light',
            borderRadius: 'moderate',
            compactMode: false,
            customCss: '',
            dashboardTitle: '',
            // Advanced security settings
            sessionTimeout: 3600,
            maxConcurrentSessions: 3,
            auditLogging: true,
            passwordPolicy: true,
            maxLoginAttempts: 5,
            lockoutDuration: 3600,
            securityEmail: ''
        };
        
        // Helper functions for notifications and sounds
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#51cf66' : '#ff6b6b'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function playSound(type = 'click') {
            // Check if sound effects are enabled
            const soundEnabled = document.getElementById('sound-effects') ? 
                document.getElementById('sound-effects').checked : true;
            
            if (!soundEnabled) return;
            
            // Create a simple beep sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Set initial gain to be quieter
                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                
                if (type === 'success') {
                    // Soft, gentle ascending tone
                    oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                    oscillator.frequency.setTargetAtTime(600, audioContext.currentTime, 0.08);
                    gainNode.gain.setTargetAtTime(0, audioContext.currentTime + 0.25, 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.25);
                } else if (type === 'error') {
                    // Soft, low tone
                    oscillator.frequency.value = 350;
                    gainNode.gain.setTargetAtTime(0, audioContext.currentTime + 0.25, 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.25);
                } else {
                    // Soft click - very brief and gentle
                    oscillator.frequency.value = 550;
                    gainNode.gain.setTargetAtTime(0, audioContext.currentTime + 0.08, 0.08);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.08);
                }
            } catch (e) {
                // Web Audio API not available
            }
        }
        
        // Load authentication utilities and check access
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src + '?t=' + Date.now(); // Cache busting
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Two-Factor Authentication Modal Functions
        async function openTwoFactorModal(user) {
            const modal = document.getElementById('twofa-modal');
            if (!modal) return;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Check current 2FA status
            checkUserTwoFAStatus(user);
        }

        function closeTwoFactorModal() {
            const modal = document.getElementById('twofa-modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        async function checkUserTwoFAStatus(user) {
            try {
                // Try to get user's 2FA status from backend
                const response = await fetch(`/api/users/${user.id}/2fa-status`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.twoFactorEnabled) {
                        showTwoFAEnabled(data);
                    } else {
                        await setupTwoFA();
                    }
                } else {
                    await setupTwoFA();
                }
            } catch (error) {
                console.error('Error checking 2FA status:', error);
                await setupTwoFA();
            }
        }

        async function setupTwoFA() {
            try {
                const checkStatusDiv = document.getElementById('twofa-check-status');
                const notEnabledDiv = document.getElementById('twofa-not-enabled');

                if (checkStatusDiv) checkStatusDiv.style.display = 'none';
                if (notEnabledDiv) notEnabledDiv.style.display = 'block';

                // Request setup code from backend
                const response = await fetch('/api/2fa/setup', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to request 2FA setup');
                }

                const data = await response.json();
                if (data.qrCode) {
                    // Display QR code
                    const qrDiv = document.getElementById('twofa-qr-code');
                    const manualCodeEl = document.getElementById('twofa-manual-code');

                    if (qrDiv) {
                        qrDiv.innerHTML = data.qrCode;
                    }
                    if (manualCodeEl) {
                        manualCodeEl.textContent = data.secret;
                    }

                    // Store the secret for verification
                    window.currentTwoFASecret = data.secret;
                }
            } catch (error) {
                console.error('Error setting up 2FA:', error);
                showNotification('Failed to setup 2FA: ' + error.message, 'error');
                closeTwoFactorModal();
            }
        }

        function showTwoFAEnabled(data) {
            const checkStatusDiv = document.getElementById('twofa-check-status');
            const enabledDiv = document.getElementById('twofa-already-enabled');

            if (checkStatusDiv) checkStatusDiv.style.display = 'none';
            if (enabledDiv) enabledDiv.style.display = 'block';

            // Display backup codes if they exist
            if (data.backupCodes && data.backupCodes.length > 0) {
                const backupCodesText = data.backupCodes.join('\n');
                const viewText = document.getElementById('twofa-backup-codes-view-text');
                if (viewText) {
                    viewText.value = backupCodesText;
                }
            }
        }
        
        // Character animation
        function pageInit(user) {
            // Require admin access
            if (user.role !== 'admin') {
                alert('Access Denied: Admin privileges required');
                window.location.href = 'dashboard.html';
                return;
            }

            // Load settings and setup functionality
            loadSettings();
            setupCharacterAnimation();
            
            // Ensure General tab is visible after loadSettings
            setTimeout(() => {
                const generalSection = document.querySelector('#general-tab');
                if (generalSection) {
                    generalSection.classList.add('active-tab');
                    generalSection.style.display = 'block'; // Force display
                    generalSection.style.visibility = 'visible';
                    generalSection.style.opacity = '1';
                    console.log('Re-activated general section in pageInit');
                }
                const generalBtn = document.querySelector('.settings-tab[data-tab="general"]');
                if (generalBtn) {
                    generalBtn.classList.add('active');
                }
            }, 50);
            
            // Add real-time theme selector changes
            document.getElementById('theme').addEventListener('change', function() {
                settings.theme = this.value;
                // Update global theme manager
                window.ThemeManager.setTheme(this.value);
                applyThemeSettings();
                playSound('click');
            });
            
            // Add real-time accessibility changes
            document.getElementById('font-size').addEventListener('change', function() {
                settings.fontSize = this.value;
                // Update global theme manager
                window.ThemeManager.setFontSize(this.value);
                applyAccessibilitySettings();
                playSound('click');
            });
            
            document.getElementById('animations').addEventListener('change', function() {
                settings.animations = this.checked;
                // Update global theme manager
                window.ThemeManager.toggleAnimations(this.checked);
                applyAccessibilitySettings();
                playSound('click');
            });
            
            document.getElementById('reduce-motion').addEventListener('change', function() {
                settings.reduceMotion = this.checked;
                // Update global theme manager
                window.ThemeManager.toggleReduceMotion(this.checked);
                applyAccessibilitySettings();
                playSound('click');
            });
            
            // New appearance settings event listeners
            document.getElementById('high-contrast').addEventListener('change', function() {
                settings.highContrast = this.checked;
                // Update global theme manager
                window.ThemeManager.toggleHighContrast(this.checked);
                applyAccessibilitySettings();
                playSound('click');
            });
            
            document.getElementById('date-format').addEventListener('change', function() {
                settings.dateFormat = this.value;
                updateDateDisplays();
                playSound('click');
            });
            
            document.getElementById('chart-theme').addEventListener('change', function() {
                settings.chartTheme = this.value;
                applyChartTheme();
                playSound('click');
            });
            
            document.getElementById('border-radius').addEventListener('change', function() {
                settings.borderRadius = this.value;
                applyAppearanceSettings();
                playSound('click');
            });
            
            document.getElementById('compact-mode').addEventListener('change', function() {
                settings.compactMode = this.checked;
                applyAppearanceSettings();
                playSound('click');
            });
            
            // Appearance settings save button listener
            document.getElementById('save-appearance').addEventListener('click', function() {
                saveAppearanceSettings();
            });
            
            // General settings event listeners
            document.getElementById('save-general').addEventListener('click', function() {
                saveGeneralSettings();
            });

            // SSO toggle listener
            document.getElementById('sso-enabled').addEventListener('change', function() {
                const ssoConfig = document.getElementById('sso-config');
                ssoConfig.style.display = this.checked ? 'block' : 'none';
                
                if (this.checked) {
                    // Set redirect URI
                    const redirectUri = `${window.location.protocol}//${window.location.host}/api/sso/callback`;
                    document.getElementById('sso-redirect-uri').value = redirectUri;
                }
            });
            
            // SSO save button listener
            const saveSSOBtn = document.getElementById('save-sso');
            if (saveSSOBtn) {
                saveSSOBtn.addEventListener('click', function() {
                    saveSSOSettings();
                });
            }

            // SMTP enabled toggle - show/hide SMTP config and notification events section
            const smtpEnabledEl = document.getElementById('smtp-enabled');
            if (smtpEnabledEl) {
                smtpEnabledEl.addEventListener('change', function() {
                    const smtpConfig = document.getElementById('smtp-config');
                    const notificationEventsSection = document.getElementById('notification-events-section');
                    const discordEnabledEl = document.getElementById('discord-enabled');
                    settings['smtp-enabled'] = this.checked;
                    
                    if (smtpConfig) {
                        smtpConfig.style.display = this.checked ? 'block' : 'none';
                    }
                    
                    // Show notification events if either SMTP or Discord is enabled
                    if (notificationEventsSection) {
                        const showEvents = this.checked || (discordEnabledEl && discordEnabledEl.checked);
                        notificationEventsSection.style.display = showEvents ? 'block' : 'none';
                    }
                    
                    playSound('click');
                });
            }

            // Discord enabled toggle - show/hide Discord config and notification events section
            const discordEnabledEl = document.getElementById('discord-enabled');
            if (discordEnabledEl) {
                discordEnabledEl.addEventListener('change', function() {
                    const discordConfig = document.getElementById('discord-config');
                    const notificationEventsSection = document.getElementById('notification-events-section');
                    const smtpEnabledEl = document.getElementById('smtp-enabled');
                    settings['discord-enabled'] = this.checked;
                    
                    if (discordConfig) {
                        discordConfig.style.display = this.checked ? 'block' : 'none';
                    }
                    
                    // Show notification events if either SMTP or Discord is enabled
                    if (notificationEventsSection) {
                        const showEvents = this.checked || (smtpEnabledEl && smtpEnabledEl.checked);
                        notificationEventsSection.style.display = showEvents ? 'block' : 'none';
                    }
                    
                    playSound('click');
                });
            }
            
            // Email alerts toggle - show/hide alert recipients card
            const emailAlertsEl = document.getElementById('email-alerts');
            if (emailAlertsEl) {
                emailAlertsEl.addEventListener('change', function() {
                    settings.emailAlerts = this.checked;
                    const alertRecipientsCard = document.getElementById('alert-recipients-card');
                    if (alertRecipientsCard) {
                        alertRecipientsCard.style.display = this.checked ? 'block' : 'none';
                    }
                    playSound('click');
                });
            }
            
            // Alert recipient type dropdown - show/hide admin selection
            const alertRecipientTypeEl = document.getElementById('alert-recipient-type');
            if (alertRecipientTypeEl) {
                alertRecipientTypeEl.addEventListener('change', function() {
                    const selectedAdminsGroup = document.getElementById('selected-admins-group');
                    if (selectedAdminsGroup) {
                        selectedAdminsGroup.style.display = this.value === 'selected' ? 'block' : 'none';
                    }
                    settings.alertRecipientType = this.value;
                    playSound('click');
                });
            }
            
            const ipWhitelistEl = document.getElementById('ip-whitelist');
            if (ipWhitelistEl) {
                ipWhitelistEl.addEventListener('change', function() {
                    const ipConfig = document.getElementById('ip-whitelist-config');
                    if (ipConfig) {
                        ipConfig.style.display = this.checked ? 'block' : 'none';
                    }
                });
            }

            // 2FA toggle listener (two-factor element was removed, so skip if it doesn't exist)
            const twoFactorEl = document.getElementById('two-factor');
            if (twoFactorEl) {
                twoFactorEl.addEventListener('change', function() {
                    const tfaConfig = document.getElementById('twofa-config');
                    const tfaSetup = document.getElementById('twofa-setup');
                    const tfaEnabled = document.getElementById('twofa-enabled');
                    
                    if (this.checked) {
                        if (tfaConfig) tfaConfig.style.display = 'block';
                        // Check if 2FA is already set up
                        checkTFAStatus();
                    } else {
                        if (tfaConfig) tfaConfig.style.display = 'none';
                        // Disable 2FA on server
                        disableTFA();
                    }
                });
            }

            // Check if 2FA is already enabled
            async function checkTFAStatus() {
                try {
                    const response = await window.Api.request('GET', '/2fa/status');
                    const tfaSetup = document.getElementById('twofa-setup');
                    const tfaEnabled = document.getElementById('twofa-enabled');
                    
                    if (response.enabled) {
                        tfaSetup.style.display = 'none';
                        tfaEnabled.style.display = 'block';
                    } else {
                        tfaSetup.style.display = 'block';
                        tfaEnabled.style.display = 'none';
                        generateTFASecret();
                    }
                } catch (error) {
                    console.log('2FA not yet configured, showing setup');
                    document.getElementById('twofa-setup').style.display = 'block';
                    document.getElementById('twofa-enabled').style.display = 'none';
                    generateTFASecret();
                }
            }

            // Generate TOTP secret and QR code
            async function generateTFASecret() {
                try {
                    const response = await window.Api.request('POST', '/2fa/generate-secret');
                    const secret = response.secret;
                    const qrCode = response.qrCode;
                    const backupCodes = response.backupCodes;
                    
                    // Display QR code
                    const qrContainer = document.getElementById('qrcode-container');
                    qrContainer.innerHTML = '';
                    qrContainer.appendChild(document.createElement('img')).src = qrCode;
                    
                    // Display backup codes
                    document.getElementById('twofa-backup-codes').value = backupCodes.join('\n');
                    
                    // Store secret for verification
                    window.currentTFASecret = secret;
                } catch (error) {
                    console.error('Failed to generate 2FA secret:', error);
                    alert('Failed to generate 2FA setup. Please try again.');
                }
            }

            // Verify 2FA and enable it
            const verify2faBtn = document.getElementById('verify-twofa-btn');
            if (verify2faBtn) {
                verify2faBtn.addEventListener('click', async function() {
                    const verificationCode = document.getElementById('twofa-verification-code').value;
                    
                    if (verificationCode.length !== 6 || isNaN(verificationCode)) {
                        alert('Please enter a valid 6-digit code from your authenticator');
                        return;
                    }
                    
                    try {
                        const response = await window.Api.request('POST', '/2fa/verify', {
                            code: verificationCode,
                            secret: window.currentTFASecret
                        });
                        
                        if (response.verified) {
                            document.getElementById('twofa-setup').style.display = 'none';
                            document.getElementById('twofa-enabled').style.display = 'block';
                            alert('2FA has been enabled successfully!');
                            saveSecuritySettings();
                        } else {
                            alert('Invalid verification code. Please try again.');
                            document.getElementById('twofa-verification-code').value = '';
                        }
                    } catch (error) {
                        console.error('Failed to verify 2FA:', error);
                        alert('Failed to verify 2FA. Please try again.');
                    }
                });
            }

            // Disable 2FA
            const disable2faBtn = document.getElementById('disable-twofa-btn');
            if (disable2faBtn) {
                disable2faBtn.addEventListener('click', async function() {
                    if (confirm('Are you sure you want to disable 2FA? Your account will be less secure.')) {
                        disableTFA();
                    }
                });
            }

            async function disableTFA() {
                try {
                    await window.Api.request('POST', '/2fa/disable');
                    document.getElementById('two-factor').checked = false;
                    document.getElementById('twofa-config').style.display = 'none';
                    alert('2FA has been disabled');
                } catch (error) {
                    console.error('Failed to disable 2FA:', error);
                    alert('Failed to disable 2FA. Please try again.');
                }
            }
            
            // Appearance settings event listeners
            document.getElementById('save-appearance').addEventListener('click', function() {
                saveAppearanceSettings();
            });
            
            // General settings event listeners now includes performance settings
            // The save-general button handles both general + performance + monitoring settings
            
            // Notifications settings event listeners
            document.getElementById('save-notifications').addEventListener('click', function() {
                saveNotificationsSettings();
            });
            
            // Test SMTP button
            document.getElementById('test-smtp-btn').addEventListener('click', function() {
                testSmtpConfiguration();
            });

            // Test Discord button
            const testDiscordBtn = document.getElementById('test-discord-btn');
            if (testDiscordBtn) {
                testDiscordBtn.addEventListener('click', function() {
                    testDiscordConfiguration();
                });
            }
            
            // Save SMTP Configuration button
            const saveSMTPBtn = document.getElementById('save-smtp-config-btn');
            if (saveSMTPBtn) {
                saveSMTPBtn.addEventListener('click', function() {
                    saveNotificationsSettings();
                });
            }
            
            // Application and User Notifications toggles
            const enableAppNotificationsToggle = document.getElementById('enable-app-notifications');
            const enableUserNotificationsToggle = document.getElementById('enable-user-notifications');
            const appNotificationsSection = document.getElementById('application-notifications-section');
            const userNotificationsSection = document.getElementById('user-notifications-section');
            
            // Function to update section visibility
            function updateNotificationsSections() {
                if (enableAppNotificationsToggle && enableAppNotificationsToggle.checked) {
                    appNotificationsSection.style.display = 'block';
                } else {
                    appNotificationsSection.style.display = 'none';
                }
                
                if (enableUserNotificationsToggle && enableUserNotificationsToggle.checked) {
                    userNotificationsSection.style.display = 'block';
                } else {
                    userNotificationsSection.style.display = 'none';
                }
            }
            
            // Add event listeners to toggles
            if (enableAppNotificationsToggle) {
                enableAppNotificationsToggle.addEventListener('change', updateNotificationsSections);
            }
            if (enableUserNotificationsToggle) {
                enableUserNotificationsToggle.addEventListener('change', updateNotificationsSections);
            }
            
            // Initialize sections on page load
            updateNotificationsSections();
            
            // Preview message buttons for notification events
            const previewButtons = document.querySelectorAll('.preview-message-btn');
            previewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const eventType = this.getAttribute('data-event');
                    testEventMessage(eventType);
                });
            });
            
            // Integration settings event listeners
            document.getElementById('test-integrations').addEventListener('click', function() {
                testIntegrations();
            });
            
            document.getElementById('save-integrations').addEventListener('click', function() {
                saveIntegrationSettings();
            });
            
            // Customization settings event listeners
            document.getElementById('reset-customization').addEventListener('click', function() {
                resetCustomization();
            });
            
            document.getElementById('save-customization').addEventListener('click', function() {
                saveCustomizationSettings();
            });
            
            // Security settings event listeners
            document.getElementById('save-security').addEventListener('click', function() {
                saveSecuritySettings();
            });
            
            // 2FA Enforcement settings listeners
            const enforce2faAllUsers = document.getElementById('enforce-2fa-all-users');
            const enforce2faAdminsOnly = document.getElementById('enforce-2fa-admins-only');
            const twoFAGracePeriod = document.getElementById('twofa-grace-period');
            
            if (enforce2faAllUsers) {
                enforce2faAllUsers.addEventListener('change', function() {
                    if (this.checked) {
                        enforce2faAdminsOnly.checked = false;
                        enforce2faAdminsOnly.parentElement.parentElement.style.opacity = '0.6';
                        enforce2faAdminsOnly.parentElement.parentElement.style.pointerEvents = 'none';
                    } else {
                        enforce2faAdminsOnly.parentElement.parentElement.style.opacity = '1';
                        enforce2faAdminsOnly.parentElement.parentElement.style.pointerEvents = 'auto';
                    }
                });
            }
            
            if (enforce2faAdminsOnly) {
                enforce2faAdminsOnly.addEventListener('change', function() {
                    if (this.checked) {
                        enforce2faAllUsers.checked = false;
                        enforce2faAllUsers.parentElement.parentElement.style.opacity = '0.6';
                        enforce2faAllUsers.parentElement.parentElement.style.pointerEvents = 'none';
                    } else {
                        enforce2faAllUsers.parentElement.parentElement.style.opacity = '1';
                        enforce2faAllUsers.parentElement.parentElement.style.pointerEvents = 'auto';
                    }
                });
            }
            
            // Initial load with delay to ensure page is ready
            setTimeout(() => {
                if (window.load2FAEnforcementStatus) {
                    window.load2FAEnforcementStatus();
                }
            }, 500);

            
            // Save settings button
            document.getElementById('save-settings').addEventListener('click', function() {
                saveSettings();
                playSound('success');
            });
            
            // Clear cache button
            document.getElementById('clear-cache').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the cache?')) {
                    const btn = this;
                    const originalText = btn.innerHTML;
                    
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Clearing...';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        alert('Cache cleared successfully!');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 1000);
                }
            });
            
            // Restart services button
            document.getElementById('restart-services').addEventListener('click', function() {
                if (confirm('Are you sure you want to restart all services? This may cause temporary downtime.')) {
                    const btn = this;
                    const originalText = btn.innerHTML;
                    
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Restarting...';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        alert('Services restarted successfully!');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 2000);
                }
            });
            
            // Simulate system metrics updates
            setInterval(() => {
                const cpuValue = Math.floor(Math.random() * 30 + 5) + '%';
                const memoryValue = Math.floor(Math.random() * 30 + 50) + '%';
                const diskValue = Math.floor(Math.random() * 10 + 40) + '%';
                const uptimeValue = Math.floor(Math.random() * 30 + 5) + 'd';
                
                // Update System Info sidebar metrics
                const cpuEl = document.getElementById('cpu-usage');
                const memEl = document.getElementById('memory-usage');
                const diskEl = document.getElementById('disk-usage');
                const uptimeEl = document.getElementById('uptime');
                
                if (cpuEl) cpuEl.textContent = cpuValue;
                if (memEl) memEl.textContent = memoryValue;
                if (diskEl) diskEl.textContent = diskValue;
                if (uptimeEl) uptimeEl.textContent = uptimeValue;
                
                // Update General tab metrics
                const genCpuEl = document.getElementById('general-cpu-usage');
                const genMemEl = document.getElementById('general-memory-usage');
                const genDiskEl = document.getElementById('general-disk-usage');
                const genUptimeEl = document.getElementById('general-uptime');
                
                if (genCpuEl) genCpuEl.textContent = cpuValue;
                if (genMemEl) genMemEl.textContent = memoryValue;
                if (genDiskEl) genDiskEl.textContent = diskValue;
                if (genUptimeEl) genUptimeEl.textContent = uptimeValue;
            }, 5000);
        }

        // Legacy updateNavigation function - kept for compatibility
        function updateNavigation(user) {
            const navContainer = document.getElementById('main-nav');
            navContainer.innerHTML = '';
            
            // Admin only dashboard button
            const dashboardBtn = document.createElement('button');
            dashboardBtn.className = 'nav-btn';
            dashboardBtn.onclick = () => window.location.href = 'index.html';
            dashboardBtn.innerHTML = '<i class="fas fa-home"></i> Dashboard';
            navContainer.appendChild(dashboardBtn);
            
            // Admin only settings button
            const settingsBtn = document.createElement('button');
            settingsBtn.className = 'nav-btn active';
            settingsBtn.innerHTML = '<i class="fas fa-cog"></i> Settings';
            navContainer.appendChild(settingsBtn);
            
            // Admin only user management button
            const userMgmtBtn = document.createElement('button');
            userMgmtBtn.className = 'nav-btn';
            userMgmtBtn.onclick = () => window.location.href = 'user-management.html';
            userMgmtBtn.innerHTML = '<i class="fas fa-users"></i> User Mgmt';
            navContainer.appendChild(userMgmtBtn);
        }
        
        // Load settings from localStorage
        // Load settings from server
        async function loadSettings() {
            try {
                // Show loading state
                console.log('Loading settings from server...');
                
                const response = await window.Api.getSettings();
                const serverSettings = response.settings;
                
                // Update local settings object from server data
                for (const [key, data] of Object.entries(serverSettings)) {
                    // Convert string values to appropriate types
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    else if (!isNaN(value) && value !== '') value = Number(value);
                    
                    settings[key] = value;
                }
                
                // Populate form fields from settings object
                const fieldMappings = {
                    'server-name': 'serverName',
                    'default-language': 'defaultLanguage',
                    'theme': 'theme',
                    'require-login': 'requireLogin',
                    'two-factor': 'twoFactor',
                    'ip-whitelist': 'ipWhitelist',
                    'allowed-ips': 'allowedIPs',
                    'auto-backup': 'autoBackup',
                    'cloud-backup': 'cloudBackup',
                    'alert-email': 'alertEmail',
                    'email-alerts': 'emailAlerts',
                    'font-size': 'fontSize',
                    'sound-effects': 'soundEffects',
                    'animations': 'animations',
                    'reduce-motion': 'reduceMotion',
                    'high-contrast': 'highContrast',
                    'date-format': 'dateFormat',
                    'chart-theme': 'chartTheme',
                    'border-radius': 'borderRadius',
                    'compact-mode': 'compactMode',
                    'api-key': 'apiKey',
                    'webhook-url': 'webhookUrl',
                    'smtp-server': 'smtpServer',
                    'cloud-provider': 'cloudProvider',
                    'analytics-enabled': 'analyticsEnabled',
                    'push-notifications': 'pushNotifications',
                    'discord-enabled': 'discordEnabled',
                    'discord-webhook': 'discordWebhook',
                    'discord-username': 'discordUsername',
                    'smtp-enabled': 'smtpEnabled',
                    'smtp-server': 'smtpServer',
                    'smtp-port': 'smtpPort',
                    'smtp-username': 'smtpUsername',
                    'smtp-password': 'smtpPassword',
                    'smtp-use-tls': 'smtpUseTls',
                    'alert-email': 'alertEmail',
                    'alert-cc-email': 'alertCcEmail',
                    'email-alerts': 'emailAlerts',
                    'email-user-notifications': 'emailUserNotifications',
                    'alert-recipient-type': 'alertRecipientType',
                    'enable-app-notifications': 'enableAppNotifications',
                    'enable-user-notifications': 'enableUserNotifications',
                    'notify-login': 'notifyLogin',
                    'notify-logout': 'notifyLogout',
                    'notify-app-start': 'notifyAppStart',
                    'notify-app-stop': 'notifyAppStop',
                    'notify-app-restart': 'notifyAppRestart',
                    'notify-errors': 'notifyErrors',
                    'notify-security': 'notifySecurity',
                    'notify-user-activity': 'notifyUserActivity',
                    'layout-style': 'layoutStyle',
                    'notification-style': 'notificationStyle',
                    'auto-refresh': 'autoRefresh',
                    'custom-css': 'customCss',
                    'dashboard-title': 'dashboardTitle',
                    'session-timeout': 'sessionTimeout',
                    'max-concurrent-sessions': 'maxConcurrentSessions',
                    'audit-logging': 'auditLogging',
                    'password-policy': 'passwordPolicy',
                    'max-login-attempts': 'maxLoginAttempts',
                    'lockout-duration': 'lockoutDuration',
                    'enforce-2fa-all-users': 'enforce2faAllUsers',
                    'twofa-grace-period': 'twoFAGracePeriod',
                    'enforce-2fa-admins-only': 'enforce2faAdminsOnly'
                };
                
                for (const [fieldId, settingKey] of Object.entries(fieldMappings)) {
                    const element = document.getElementById(fieldId);
                    // Use the hyphenated key (fieldId) to look up in settings, not the camelCase version
                    if (element && settings[fieldId] !== undefined) {
                        if (element.type === 'checkbox') {
                            element.checked = settings[fieldId];
                        } else {
                            element.value = settings[fieldId];
                        }
                    }
                }
                
                // Apply current settings
                applyThemeSettings();
                applyAccessibilitySettings();
                applyAppearanceSettings();
                applyCustomCss();
                updateDateDisplays();
                applyChartTheme();
                
                // Sync theme preferences to global theme manager
                window.ThemeManager.syncFromSettings(settings);
                
                // Initialize Discord config visibility
                const discordConfig = document.getElementById('discord-config');
                if (discordConfig && settings['discord-enabled']) {
                    discordConfig.style.display = 'block';
                    const discordEnabledCheckbox = document.getElementById('discord-enabled');
                    if (discordEnabledCheckbox) {
                        discordEnabledCheckbox.checked = settings['discord-enabled'];
                    }
                }
                
                // Initialize SMTP config visibility
                const smtpConfig = document.getElementById('smtp-config');
                if (smtpConfig && settings['smtp-enabled']) {
                    smtpConfig.style.display = 'block';
                    const smtpEnabledCheckbox = document.getElementById('smtp-enabled');
                    if (smtpEnabledCheckbox) {
                        smtpEnabledCheckbox.checked = settings['smtp-enabled'];
                    }
                }
                
                // Initialize Notification Events section visibility
                const notificationEventsSection = document.getElementById('notification-events-section');
                if (notificationEventsSection) {
                    const showNotifications = settings['discord-enabled'] || settings['smtp-enabled'];
                    notificationEventsSection.style.display = showNotifications ? 'block' : 'none';
                }
                
                // Initialize alert recipients card visibility based on email-alerts toggle
                const emailAlertsCheckbox = document.getElementById('email-alerts');
                const alertRecipientsCard = document.getElementById('alert-recipients-card');
                if (alertRecipientsCard && emailAlertsCheckbox) {
                    alertRecipientsCard.style.display = emailAlertsCheckbox.checked ? 'block' : 'none';
                }
                
                // Initialize selected admins group visibility based on alert recipient type
                const selectedAdminsGroup = document.getElementById('selected-admins-group');
                const alertRecipientTypeEl = document.getElementById('alert-recipient-type');
                if (selectedAdminsGroup && alertRecipientTypeEl) {
                    selectedAdminsGroup.style.display = alertRecipientTypeEl.value === 'selected' ? 'block' : 'none';
                }
                
                // Initialize Application and User Notifications sections visibility
                const enableAppNotificationsCheckbox = document.getElementById('enable-app-notifications');
                const enableUserNotificationsCheckbox = document.getElementById('enable-user-notifications');
                const appNotificationsSection = document.getElementById('application-notifications-section');
                const userNotificationsSection = document.getElementById('user-notifications-section');
                
                if (appNotificationsSection && enableAppNotificationsCheckbox) {
                    appNotificationsSection.style.display = enableAppNotificationsCheckbox.checked ? 'block' : 'none';
                }
                
                if (userNotificationsSection && enableUserNotificationsCheckbox) {
                    userNotificationsSection.style.display = enableUserNotificationsCheckbox.checked ? 'block' : 'none';
                }
                
                console.log('Settings loaded successfully from server');
            } catch (error) {
                console.error('Failed to load settings from server:', error);
                showNotification('Failed to load settings. Using defaults.', 'error');
                // Fall back to defaults if server fails
            }
        }
        
        // Save settings to server
        async function saveSettings() {
            try {
                const btn = document.getElementById('save-settings');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                // Collect settings from form fields
                const settingsToSave = {
                    serverName: { value: document.getElementById('server-name').value, category: 'general' },
                    defaultLanguage: { value: document.getElementById('default-language').value, category: 'general' },
                    theme: { value: document.getElementById('theme').value, category: 'appearance' },
                    requireLogin: { value: String(document.getElementById('require-login').checked), category: 'security' },
                    twoFactor: { value: String(document.getElementById('two-factor').checked), category: 'security' },
                    ipWhitelist: { value: String(document.getElementById('ip-whitelist').checked), category: 'security' },
                    allowedIPs: { value: document.getElementById('allowed-ips').value, category: 'security' },
                    autoBackup: { value: String(document.getElementById('auto-backup').checked), category: 'backup' },
                    cloudBackup: { value: String(document.getElementById('cloud-backup').checked), category: 'backup' },
                    alertEmail: { value: document.getElementById('alert-email').value, category: 'notifications' },
                    emailAlerts: { value: String(document.getElementById('email-alerts').checked), category: 'notifications' },
                    fontSize: { value: document.getElementById('font-size').value, category: 'appearance' },
                    soundEffects: { value: String(document.getElementById('sound-effects').checked), category: 'appearance' },
                    animations: { value: String(document.getElementById('animations').checked), category: 'appearance' },
                    reduceMotion: { value: String(document.getElementById('reduce-motion').checked), category: 'appearance' },
                    apiKey: { value: document.getElementById('api-key').value, category: 'integration' },
                    webhookUrl: { value: document.getElementById('webhook-url').value, category: 'integration' },
                    smtpServer: { value: document.getElementById('smtp-server').value, category: 'integration' },
                    cloudProvider: { value: document.getElementById('cloud-provider').value, category: 'integration' },
                    analyticsEnabled: { value: String(document.getElementById('analytics-enabled').checked), category: 'integration' },
                    pushNotifications: { value: String(document.getElementById('push-notifications').checked), category: 'notifications' },
                    slackWebhook: { value: document.getElementById('slack-webhook').value, category: 'integration' },
                    discordWebhook: { value: document.getElementById('discord-webhook').value, category: 'integration' },
                    layoutStyle: { value: document.getElementById('layout-style').value, category: 'customization' },
                    notificationStyle: { value: document.getElementById('notification-style').value, category: 'customization' },
                    autoRefresh: { value: String(document.getElementById('auto-refresh').checked), category: 'customization' },
                    colorScheme: { value: document.getElementById('color-scheme').value, category: 'customization' },
                    dateFormat: { value: document.getElementById('date-format').value, category: 'customization' },
                    chartTheme: { value: document.getElementById('chart-theme').value, category: 'customization' },
                    customCss: { value: document.getElementById('custom-css').value, category: 'customization' },
                    dashboardTitle: { value: document.getElementById('dashboard-title').value, category: 'customization' },
                    sessionTimeout: { value: String(document.getElementById('session-timeout').value), category: 'security' },
                    maxConcurrentSessions: { value: String(document.getElementById('max-concurrent-sessions').value), category: 'security' },
                    auditLogging: { value: String(document.getElementById('audit-logging').checked), category: 'security' },
                    passwordPolicy: { value: String(document.getElementById('password-policy').checked), category: 'security' },
                    maxLoginAttempts: { value: String(document.getElementById('max-login-attempts').value), category: 'security' },
                    lockoutDuration: { value: String(document.getElementById('lockout-duration').value), category: 'security' }
                };
                
                // Save to server
                await window.Api.updateSettings(settingsToSave, 'user');
                
                // Update local settings object
                for (const [key, data] of Object.entries(settingsToSave)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    else if (!isNaN(value) && value !== '') value = Number(value);
                    settings[key] = value;
                }
                
                // Apply settings immediately
                applyThemeSettings();
                applyAccessibilitySettings();
                applyCustomCss();
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Settings saved successfully!', 'success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save settings:', error);
                showNotification('Failed to save settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-settings');
                btn.innerHTML = '<i class="fas fa-save"></i> Save All Settings';
                btn.disabled = false;
            }
        }
        
        // Save General settings (now includes Performance & Monitoring)
        async function saveGeneralSettings() {
            try {
                const btn = document.getElementById('save-general');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                const generalSettings = {
                    serverName: { value: document.getElementById('server-name').value, category: 'general' },
                    defaultLanguage: { value: document.getElementById('default-language').value, category: 'general' },
                    // Performance settings now included in General
                    cacheDuration: { value: String(document.getElementById('cache-duration').value), category: 'performance' },
                    compression: { value: String(document.getElementById('compression').checked), category: 'performance' },
                    lazyLoading: { value: String(document.getElementById('lazy-loading').checked), category: 'performance' },
                    monitoringInterval: { value: String(document.getElementById('monitoring-interval').value), category: 'performance' },
                    memoryOptimization: { value: String(document.getElementById('memory-optimization').checked), category: 'performance' },
                    preloading: { value: String(document.getElementById('preloading').checked), category: 'performance' },
                    maxConcurrentRequests: { value: String(document.getElementById('max-concurrent-requests').value), category: 'performance' }
                };
                
                await window.Api.updateSettings(generalSettings, 'user');
                
                for (const [key, data] of Object.entries(generalSettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    else if (!isNaN(value) && value !== '') value = Number(value);
                    settings[key] = value;
                }
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('General settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save general settings:', error);
                showNotification('Failed to save general settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-general');
                btn.innerHTML = '<i class="fas fa-save"></i> Save General Settings';
                btn.disabled = false;
            }
        }
        
        // Save Appearance settings
        async function saveAppearanceSettings() {
            try {
                const btn = document.getElementById('save-appearance');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                const appearanceSettings = {
                    theme: { value: document.getElementById('theme').value, category: 'appearance' },
                    fontSize: { value: document.getElementById('font-size').value, category: 'appearance' },
                    soundEffects: { value: String(document.getElementById('sound-effects').checked), category: 'appearance' },
                    animations: { value: String(document.getElementById('animations').checked), category: 'appearance' },
                    reduceMotion: { value: String(document.getElementById('reduce-motion').checked), category: 'appearance' },
                    highContrast: { value: String(document.getElementById('high-contrast').checked), category: 'appearance' },
                    dateFormat: { value: document.getElementById('date-format').value, category: 'appearance' },
                    chartTheme: { value: document.getElementById('chart-theme').value, category: 'appearance' },
                    borderRadius: { value: document.getElementById('border-radius').value, category: 'appearance' },
                    compactMode: { value: String(document.getElementById('compact-mode').checked), category: 'appearance' }
                };
                
                await window.Api.updateSettings(appearanceSettings, 'user');
                
                for (const [key, data] of Object.entries(appearanceSettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    settings[key] = value;
                }
                
                applyThemeSettings();
                applyAccessibilitySettings();
                applyAppearanceSettings();
                updateDateDisplays();
                applyChartTheme();
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Appearance settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save appearance settings:', error);
                showNotification('Failed to save appearance settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-appearance');
                btn.innerHTML = '<i class="fas fa-save"></i> Save Appearance Settings';
                btn.disabled = false;
            }
        }
        
        // Save Performance settings
        async function savePerformanceSettings() {
            try {
                const btn = document.getElementById('save-performance');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                const performanceSettings = {
                    cacheDuration: { value: String(document.getElementById('cache-duration').value), category: 'performance' },
                    compression: { value: String(document.getElementById('compression').checked), category: 'performance' },
                    lazyLoading: { value: String(document.getElementById('lazy-loading').checked), category: 'performance' },
                    monitoringInterval: { value: String(document.getElementById('monitoring-interval').value), category: 'performance' },
                    memoryOptimization: { value: String(document.getElementById('memory-optimization').checked), category: 'performance' },
                    preloading: { value: String(document.getElementById('preloading').checked), category: 'performance' },
                    maxConcurrentRequests: { value: String(document.getElementById('max-concurrent-requests').value), category: 'performance' }
                };
                
                await window.Api.updateSettings(performanceSettings, 'user');
                
                for (const [key, data] of Object.entries(performanceSettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    else if (!isNaN(value) && value !== '') value = Number(value);
                    settings[key] = value;
                }
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Performance settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save performance settings:', error);
                showNotification('Failed to save performance settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-performance');
                btn.innerHTML = '<i class="fas fa-save"></i> Save Performance Settings';
                btn.disabled = false;
            }
        }
        
        // Save Notifications settings
        async function saveNotificationsSettings() {
            try {
                const btn = document.getElementById('save-notifications');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                // Helper function to safely get element value
                const safeGetValue = (id, defaultValue = '') => {
                    const el = document.getElementById(id);
                    if (!el) return defaultValue;
                    return el.type === 'checkbox' ? String(el.checked) : el.value;
                };
                
                const notificationsSettings = {
                    // Discord settings
                    'discord-enabled': { value: safeGetValue('discord-enabled', 'false'), category: 'notifications' },
                    'discord-webhook': { value: safeGetValue('discord-webhook'), category: 'notifications' },
                    'discord-username': { value: safeGetValue('discord-username'), category: 'notifications' },
                    // SMTP settings
                    'smtp-enabled': { value: safeGetValue('smtp-enabled', 'false'), category: 'notifications' },
                    'smtp-server': { value: safeGetValue('smtp-server'), category: 'notifications' },
                    'smtp-port': { value: safeGetValue('smtp-port', '587'), category: 'notifications' },
                    'smtp-username': { value: safeGetValue('smtp-username'), category: 'notifications' },
                    'smtp-password': { value: safeGetValue('smtp-password'), category: 'notifications' },
                    'smtp-use-tls': { value: safeGetValue('smtp-use-tls', 'false'), category: 'notifications' },
                    'alert-cc-email': { value: safeGetValue('alert-cc-email'), category: 'notifications' },
                    'email-alerts': { value: safeGetValue('email-alerts', 'false'), category: 'notifications' },
                    'email-user-notifications': { value: safeGetValue('email-user-notifications', 'false'), category: 'notifications' },
                    'alert-recipient-type': { value: safeGetValue('alert-recipient-type', 'admins'), category: 'notifications' },
                    // Event notification categories
                    'enable-app-notifications': { value: safeGetValue('enable-app-notifications', 'true'), category: 'notifications' },
                    'enable-user-notifications': { value: safeGetValue('enable-user-notifications', 'true'), category: 'notifications' },
                    // Application event notifications
                    'notify-login': { value: safeGetValue('notify-login', 'false'), category: 'notifications' },
                    'notify-logout': { value: safeGetValue('notify-logout', 'false'), category: 'notifications' },
                    'notify-app-start': { value: safeGetValue('notify-app-start', 'false'), category: 'notifications' },
                    'notify-app-stop': { value: safeGetValue('notify-app-stop', 'false'), category: 'notifications' },
                    'notify-app-restart': { value: safeGetValue('notify-app-restart', 'false'), category: 'notifications' },
                    'notify-errors': { value: safeGetValue('notify-errors', 'false'), category: 'notifications' },
                    'notify-security': { value: safeGetValue('notify-security', 'false'), category: 'notifications' },
                    'notify-user-activity': { value: safeGetValue('notify-user-activity', 'false'), category: 'notifications' }
                };
                
                console.log('Saving notification settings:', notificationsSettings);
                await window.Api.updateSettings(notificationsSettings, 'system');
                
                for (const [key, data] of Object.entries(notificationsSettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    else if (!isNaN(value) && value !== '') value = Number(value);
                    settings[key] = value;
                }
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Notification settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save notification settings:', error);
                showNotification('Failed to save notification settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-notifications');
                btn.innerHTML = '<i class="fas fa-save"></i> Save Notification Settings';
                btn.disabled = false;
            }
        }
        
        // Test SMTP Configuration
        async function testSmtpConfiguration() {
            try {
                const btn = document.getElementById('test-smtp-btn');
                const resultDiv = document.getElementById('smtp-test-result');
                const originalText = btn.innerHTML;
                
                // Get test recipient email
                const testRecipient = document.getElementById('smtp-test-recipient').value;
                
                if (!testRecipient) {
                    showNotification('Please enter a test email address', 'error');
                    return;
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(testRecipient)) {
                    showNotification('Please enter a valid email address', 'error');
                    return;
                }
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                btn.disabled = true;
                resultDiv.style.display = 'none';
                
                // Call the test-smtp API endpoint
                const response = await window.Api.request('POST', '/settings/test-smtp', {
                    recipient: testRecipient
                });
                
                if (response.success) {
                    resultDiv.style.background = 'rgba(76, 175, 80, 0.1)';
                    resultDiv.style.borderLeft = '4px solid #4CAF50';
                    resultDiv.style.color = '#2E7D32';
                    resultDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check-circle" style="font-size: 1.2rem;"></i>
                            <div>
                                <strong> Test Email Sent!</strong><br>
                                <small>Email sent to: ${testRecipient}</small>
                            </div>
                        </div>
                    `;
                    showNotification('Test email sent successfully! Check your inbox.', 'success');
                    playSound('success');
                } else {
                    resultDiv.style.background = 'rgba(244, 67, 54, 0.1)';
                    resultDiv.style.borderLeft = '4px solid #F44336';
                    resultDiv.style.color = '#C62828';
                    const errorMsg = response.message || response.error;
                    const errorCode = response.code ? ` (${response.code})` : '';
                    const errorDetails = response.details ? `<br><small>${response.details}</small>` : '';
                    resultDiv.innerHTML = `
                        <div style="display: flex; align-items: flex-start; gap: 10px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 1.2rem; margin-top: 2px;"></i>
                            <div>
                                <strong> Test Failed${errorCode}</strong><br>
                                <small>${errorMsg}${errorDetails}</small>
                            </div>
                        </div>
                    `;
                    showNotification('Test email failed: ' + errorMsg, 'error');
                    playSound('error');
                }
                
                resultDiv.style.display = 'block';
                btn.innerHTML = originalText;
                btn.disabled = false;
                
            } catch (error) {
                console.error('SMTP test error:', error);
                const resultDiv = document.getElementById('smtp-test-result');
                resultDiv.style.background = 'rgba(244, 67, 54, 0.1)';
                resultDiv.style.borderLeft = '4px solid #F44336';
                resultDiv.style.color = '#C62828';
                resultDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 1.2rem;"></i>
                        <div>
                            <strong> Error</strong><br>
                            <small>${error.message}</small>
                        </div>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
                const btn = document.getElementById('test-smtp-btn');
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Test Email';
                btn.disabled = false;
                
                showNotification('SMTP test error: ' + error.message, 'error');
                playSound('error');
            }
        }

        // Test Discord Configuration
        async function testDiscordConfiguration() {
            try {
                const btn = document.getElementById('test-discord-btn');
                const originalText = btn.innerHTML;
                const webhookUrl = document.getElementById('discord-webhook').value;
                const botUsername = document.getElementById('discord-username').value || 'Landio Bot';
                
                if (!webhookUrl) {
                    showNotification('Please enter a Discord webhook URL first', 'error');
                    return;
                }
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                btn.disabled = true;
                
                // Call the test-discord API endpoint with webhook URL and username
                const response = await window.Api.request('POST', '/settings/test-discord', {
                    webhookUrl: webhookUrl,
                    botUsername: botUsername
                });
                
                if (response.success) {
                    showNotification(' Discord test successful! Check your Discord channel.', 'success');
                    playSound('success');
                } else {
                    const errorMsg = response.message || response.error || 'Unknown error';
                    showNotification(' Discord test failed: ' + errorMsg, 'error');
                    playSound('error');
                }
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                
            } catch (error) {
                console.error('Discord test error:', error);
                const btn = document.getElementById('test-discord-btn');
                btn.innerHTML = '<i class="fab fa-discord"></i> Send Test Message';
                btn.disabled = false;
                
                const errorMsg = error.message || 'Unable to test Discord webhook';
                showNotification('Discord test error: ' + errorMsg, 'error');
                playSound('error');
            }
        }
        
        // Preview notification message for an event
        function testEventMessage(eventType) {
            try {
                // Check which notification methods are enabled
                const discordEnabled = document.getElementById('discord-enabled')?.checked || false;
                const smtpEnabled = document.getElementById('smtp-enabled')?.checked || false;
                
                if (!discordEnabled && !smtpEnabled) {
                    showNotification('Please enable at least one notification method (Discord or SMTP) first.', 'warning');
                    return;
                }
                
                // Event message templates
                const eventTemplates = {
                    'login': {
                        title: 'User Login',
                        emailSubject: 'User Login Alert',
                        emailBody: '<strong>User Login Detected</strong><br><br>A user has logged into the system.<br><br><strong>Details:</strong><ul><li>Username: [USERNAME]</li><li>Time: [TIMESTAMP]</li><li>IP Address: [IP_ADDRESS]</li></ul>',
                        discordMessage: 'User Login Detected\n\nA user has logged into the system.\n\n**Details:**\n Username: [USERNAME]\n Time: [TIMESTAMP]\n IP Address: [IP_ADDRESS]'
                    },
                    'logout': {
                        title: 'User Logout',
                        emailSubject: 'User Logout Alert',
                        emailBody: '<strong>User Logout Detected</strong><br><br>A user has logged out of the system.<br><br><strong>Details:</strong><ul><li>Username: [USERNAME]</li><li>Time: [TIMESTAMP]</li></ul>',
                        discordMessage: 'User Logout Detected\n\nA user has logged out of the system.\n\n**Details:**\n Username: [USERNAME]\n Time: [TIMESTAMP]'
                    },
                    'app-start': {
                        title: 'Application Start',
                        emailSubject: 'Application Started',
                        emailBody: '<strong>Application Started</strong><br><br>The Landio Dashboard application has been started.<br><br><strong>Details:</strong><ul><li>Time: [TIMESTAMP]</li><li>Version: [VERSION]</li></ul>',
                        discordMessage: 'Application Started\n\nThe Landio Dashboard application has been started.\n\n**Details:**\n Time: [TIMESTAMP]\n Version: [VERSION]'
                    },
                    'app-stop': {
                        title: 'Application Stop',
                        emailSubject: 'Application Stopped',
                        emailBody: '<strong>Application Stopped</strong><br><br>The Landio Dashboard application has been stopped.<br><br><strong>Details:</strong><ul><li>Time: [TIMESTAMP]</li></ul>',
                        discordMessage: 'Application Stopped\n\nThe Landio Dashboard application has been stopped.\n\n**Details:**\n Time: [TIMESTAMP]'
                    },
                    'app-restart': {
                        title: 'Application Restart',
                        emailSubject: 'Application Restarted',
                        emailBody: '<strong>Application Restarted</strong><br><br>The Landio Dashboard application has been restarted.<br><br><strong>Details:</strong><ul><li>Time: [TIMESTAMP]</li><li>Version: [VERSION]</li></ul>',
                        discordMessage: 'Application Restarted\n\nThe Landio Dashboard application has been restarted.\n\n**Details:**\n Time: [TIMESTAMP]\n Version: [VERSION]'
                    },
                    'errors': {
                        title: 'System Errors',
                        emailSubject: 'System Error Alert',
                        emailBody: '<strong>System Error Detected</strong><br><br>An error has occurred in the system.<br><br><strong>Details:</strong><ul><li>Error: [ERROR_MESSAGE]</li><li>Timestamp: [TIMESTAMP]</li><li>Component: [COMPONENT]</li></ul>',
                        discordMessage: 'System Error Detected\n\nAn error has occurred in the system.\n\n**Details:**\n Error: [ERROR_MESSAGE]\n Timestamp: [TIMESTAMP]\n Component: [COMPONENT]'
                    },
                    'security': {
                        title: 'Security Alert',
                        emailSubject: 'Security Alert',
                        emailBody: '<strong>Security Alert</strong><br><br>A security event has been detected.<br><br><strong>Details:</strong><ul><li>Event: [SECURITY_EVENT]</li><li>Timestamp: [TIMESTAMP]</li><li>IP Address: [IP_ADDRESS]</li><li>Severity: [SEVERITY]</li></ul>',
                        discordMessage: 'Security Alert\n\nA security event has been detected.\n\n**Details:**\n Event: [SECURITY_EVENT]\n Timestamp: [TIMESTAMP]\n IP Address: [IP_ADDRESS]\n Severity: [SEVERITY]'
                    },
                    'user-activity': {
                        title: 'User Activity',
                        emailSubject: 'User Activity Notification',
                        emailBody: '<strong>User Activity Notification</strong><br><br>User account activity has been detected.<br><br><strong>Details:</strong><ul><li>User: [USERNAME]</li><li>Activity: [ACTIVITY_TYPE]</li><li>Timestamp: [TIMESTAMP]</li></ul>',
                        discordMessage: 'User Activity Notification\n\nUser account activity has been detected.\n\n**Details:**\n User: [USERNAME]\n Activity: [ACTIVITY_TYPE]\n Timestamp: [TIMESTAMP]'
                    }
                };
                
                const template = eventTemplates[eventType];
                if (!template) {
                    showNotification('Unknown event type', 'error');
                    return;
                }
                
                // Create modal for preview
                let previewHTML = `
                    <div id="messagePreviewModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                        <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; color: #333;">
                            <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                                <h2 style="margin: 0; font-size: 1.3rem;">${template.title} - Message Preview</h2>
                                <button id="closePreviewBtn" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;"></button>
                            </div>
                            <div style="padding: 20px;">
                `;
                
                // Show SMTP preview if enabled
                if (smtpEnabled) {
                    previewHTML += `
                        <div style="margin-bottom: 20px;">
                            <h3 style="margin-top: 0; color: #1976D2; border-bottom: 2px solid #1976D2; padding-bottom: 10px;"> Email Preview (SMTP)</h3>
                            <div style="background: #f5f5f5; padding: 15px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.9rem;">
                                <div style="margin-bottom: 10px;"><strong>From:</strong> [SENDER_ADDRESS]</div>
                                <div style="margin-bottom: 10px;"><strong>To:</strong> [RECIPIENT_ADDRESS]</div>
                                <div style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #ddd;"><strong>Subject:</strong> ${template.emailSubject}</div>
                                <div style="background: white; padding: 12px; border-radius: 3px; min-height: 100px;">${template.emailBody}</div>
                            </div>
                        </div>
                    `;
                }
                
                // Show Discord preview if enabled
                if (discordEnabled) {
                    previewHTML += `
                        <div>
                            <h3 style="margin-top: 0; color: #5865F2; border-bottom: 2px solid #5865F2; padding-bottom: 10px;"> Discord Preview</h3>
                            <div style="background: #2C2F33; padding: 15px; border-radius: 4px; color: #DCDDDE; font-family: 'Segoe UI', Tahoma, sans-serif;">
                                <div style="margin-bottom: 8px;"><strong style="color: #99AAB5;">Bot Name:</strong> [DISCORD_BOT_USERNAME]</div>
                                <div style="background: #36393F; padding: 12px; border-radius: 3px; border-left: 4px solid #5865F2; min-height: 80px; white-space: pre-wrap; word-break: break-word;">${template.discordMessage}</div>
                            </div>
                        </div>
                    `;
                }
                
                previewHTML += `
                            </div>
                            <div style="padding: 15px; border-top: 1px solid #eee; background: #f9f9f9; border-radius: 0 0 8px 8px;">
                                <button id="closeModalBtn" class="btn btn-primary" style="width: 100%;">
                                    <i class="fas fa-check"></i> Close
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to page
                const modalDiv = document.createElement('div');
                modalDiv.innerHTML = previewHTML;
                const modal = modalDiv.firstElementChild;
                document.body.appendChild(modal);
                
                // Add event listeners to close buttons
                const closeBtn = document.getElementById('closePreviewBtn');
                const closeModalBtn = document.getElementById('closeModalBtn');
                
                const closeModal = () => {
                    const modalToRemove = document.getElementById('messagePreviewModal');
                    if (modalToRemove) {
                        modalToRemove.remove();
                    }
                };
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', closeModal);
                }
                if (closeModalBtn) {
                    closeModalBtn.addEventListener('click', closeModal);
                }
                
            } catch (error) {
                console.error('Error showing message preview:', error);
                showNotification('Failed to show message preview: ' + error.message, 'error');
            }
        }
        
        // Apply theme settings
        function applyThemeSettings() {
            const body = document.body;
            const isDarkMode = settings.darkMode;
            const theme = settings.theme || 'anime';
            
            // Remove all theme classes
            body.classList.remove('theme-pastel', 'theme-cyber', 'theme-mocha', 'theme-ice', 'theme-nature', 'theme-sunset');
            
            // Apply selected theme
            body.classList.add(`theme-${theme}`);
            
            // Apply dark mode if enabled
            if (isDarkMode) {
                body.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
            }
            
            // Theme saving is now handled by ThemeManager.setTheme()
            // which saves to both localStorage and server
        }
        
        // Apply accessibility settings
        function applyAccessibilitySettings() {
            const body = document.body;
            
            // Font size
            body.classList.remove('font-small', 'font-medium', 'font-large', 'font-extra-large');
            body.classList.add(`font-${settings.fontSize}`);
            
            // High contrast
            if (settings.highContrast) {
                body.classList.add('high-contrast');
            } else {
                body.classList.remove('high-contrast');
            }
            
            // Animations
            if (settings.animations && !settings.reduceMotion) {
                body.classList.add('animations-enabled');
            } else {
                body.classList.remove('animations-enabled');
            }
            
            // Reduce motion (takes precedence over animations)
            if (settings.reduceMotion) {
                body.classList.add('reduce-motion');
            } else {
                body.classList.remove('reduce-motion');
            }
        }
        
        function applyAppearanceSettings() {
            const body = document.body;
            
            // Border radius
            body.classList.remove('border-radius-sharp', 'border-radius-slight', 'border-radius-moderate', 'border-radius-rounded', 'border-radius-pill');
            if (settings.borderRadius) {
                body.classList.add(`border-radius-${settings.borderRadius}`);
            }
            
            // Compact mode
            if (settings.compactMode) {
                body.classList.add('compact-mode');
            } else {
                body.classList.remove('compact-mode');
            }
        }
        
        // Format date based on selected format
        function formatDate(date, format) {
            if (!date) return '';
            if (typeof date === 'string') date = new Date(date);
            
            const d = String(date.getDate()).padStart(2, '0');
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const y = date.getFullYear();
            const monthName = date.toLocaleString('default', { month: 'short' });
            const monthLong = date.toLocaleString('default', { month: 'long' });
            
            switch(format) {
                case 'MM/DD/YYYY': return `${m}/${d}/${y}`;
                case 'DD/MM/YYYY': return `${d}/${m}/${y}`;
                case 'YYYY-MM-DD': return `${y}-${m}-${d}`;
                case 'MMM DD, YYYY': return `${monthName} ${d}, ${y}`;
                case 'DD MMM YYYY': return `${d} ${monthName} ${y}`;
                default: return `${m}/${d}/${y}`;
            }
        }
        
        // Update all date displays on page
        function updateDateDisplays() {
            const dateElements = document.querySelectorAll('[data-date]');
            dateElements.forEach(el => {
                const originalDate = el.getAttribute('data-date');
                if (originalDate) {
                    el.textContent = formatDate(originalDate, settings.dateFormat);
                }
            });
        }
        
        // Apply chart theme
        function applyChartTheme() {
            const body = document.body;
            body.classList.remove('chart-theme-light', 'chart-theme-dark', 'chart-theme-auto');
            body.classList.add(`chart-theme-${settings.chartTheme}`);
        }
        
        // Test integrations
        function testIntegrations() {
            const btn = document.getElementById('test-integrations');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
            btn.disabled = true;
            
            // Simulate testing integrations
            setTimeout(() => {
                const results = [];
                
                if (document.getElementById('api-key').value) {
                    results.push(' API Key configured');
                }
                
                if (document.getElementById('webhook-url').value) {
                    results.push(' Webhook URL configured');
                }
                
                if (document.getElementById('slack-webhook').value) {
                    results.push(' Slack integration configured');
                }
                
                if (document.getElementById('discord-webhook').value) {
                    results.push(' Discord integration configured');
                }
                
                if (results.length === 0) {
                    alert('No integrations configured to test.');
                } else {
                    alert('Integration Test Results:\n\n' + results.join('\n'));
                }
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                playSound('success');
            }, 2000);
        }
        
        // Save integration settings separately
        async function saveIntegrationSettings() {
            try {
                const btn = document.getElementById('save-integrations');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                // Collect integration settings
                const integrationSettings = {
                    apiKey: { value: document.getElementById('api-key').value, category: 'integration' },
                    webhookUrl: { value: document.getElementById('webhook-url').value, category: 'integration' },
                    smtpServer: { value: document.getElementById('smtp-server').value, category: 'integration' },
                    cloudProvider: { value: document.getElementById('cloud-provider').value, category: 'integration' },
                    analyticsEnabled: { value: String(document.getElementById('analytics-enabled').checked), category: 'integration' },
                    pushNotifications: { value: String(document.getElementById('push-notifications').checked), category: 'notifications' },
                    slackWebhook: { value: document.getElementById('slack-webhook').value, category: 'integration' },
                    discordWebhook: { value: document.getElementById('discord-webhook').value, category: 'integration' }
                };
                
                // Save to server
                await window.Api.updateSettings(integrationSettings, 'user');
                
                // Update local settings
                for (const [key, data] of Object.entries(integrationSettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    settings[key] = value;
                }
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Integration settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save integration settings:', error);
                showNotification('Failed to save integration settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-integrations');
                btn.innerHTML = '<i class="fas fa-save"></i> Save Integration Settings';
                btn.disabled = false;
            }
        }
        
        // Reset customization settings to defaults
        function resetCustomization() {
            if (confirm('Are you sure you want to reset all customization settings to defaults?')) {
                // Reset customization settings
                settings.layoutStyle = 'grid';
                settings.notificationStyle = 'toast';
                settings.autoRefresh = true;
                settings.colorScheme = 'default';
                settings.dateFormat = 'MM/DD/YYYY';
                settings.chartTheme = 'light';
                settings.customCss = '';
                settings.dashboardTitle = '';
                
                // Update form fields
                document.getElementById('layout-style').value = settings.layoutStyle;
                document.getElementById('notification-style').value = settings.notificationStyle;
                document.getElementById('auto-refresh').checked = settings.autoRefresh;
                document.getElementById('color-scheme').value = settings.colorScheme;
                document.getElementById('date-format').value = settings.dateFormat;
                document.getElementById('chart-theme').value = settings.chartTheme;
                document.getElementById('custom-css').value = settings.customCss;
                document.getElementById('dashboard-title').value = settings.dashboardTitle;
                
                localStorage.setItem('settings', JSON.stringify(settings));
                alert('Customization settings reset to defaults!');
                playSound('success');
            }
        }
        
        // Save customization settings separately
        async function saveCustomizationSettings() {
            try {
                const btn = document.getElementById('save-customization');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                // Collect customization settings
                const customizationSettings = {
                    layoutStyle: { value: document.getElementById('layout-style').value, category: 'customization' },
                    notificationStyle: { value: document.getElementById('notification-style').value, category: 'customization' },
                    autoRefresh: { value: String(document.getElementById('auto-refresh').checked), category: 'customization' },
                    colorScheme: { value: document.getElementById('color-scheme').value, category: 'customization' },
                    dateFormat: { value: document.getElementById('date-format').value, category: 'customization' },
                    chartTheme: { value: document.getElementById('chart-theme').value, category: 'customization' },
                    customCss: { value: document.getElementById('custom-css').value, category: 'customization' },
                    dashboardTitle: { value: document.getElementById('dashboard-title').value, category: 'customization' }
                };
                
                // Save to server
                await window.Api.updateSettings(customizationSettings, 'user');
                
                // Update local settings
                for (const [key, data] of Object.entries(customizationSettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    settings[key] = value;
                }
                
                // Apply custom CSS if provided
                applyCustomCss();
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Customization settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save customization settings:', error);
                showNotification('Failed to save customization settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-customization');
                btn.innerHTML = '<i class="fas fa-save"></i> Save Customization Settings';
                btn.disabled = false;
            }
        }
        
        // Apply custom CSS
        function applyCustomCss() {
            // Remove existing custom CSS
            const existingStyle = document.getElementById('custom-css-style');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Add new custom CSS if provided
            if (settings.customCss.trim()) {
                const style = document.createElement('style');
                style.id = 'custom-css-style';
                style.textContent = settings.customCss;
                document.head.appendChild(style);
            }
        }
        
        // Setup character animation based on settings
        function setupCharacterAnimation() {
            const characterContainer = document.querySelector('.character-container');
            
            if (characterContainer) {
                // Apply animations based on settings
                if (settings.animations && !settings.reduceMotion) {
                    characterContainer.classList.add('animations-enabled');
                } else {
                    characterContainer.classList.remove('animations-enabled');
                }
            }
        }
        
        // View audit log
        function viewAuditLog() {
            const mockAuditLog = [
                '2024-01-15 10:30: User admin logged in',
                '2024-01-15 10:35: User admin accessed settings',
                '2024-01-15 10:40: Settings modified by admin',
                '2024-01-15 11:00: User admin logged out',
                '2024-01-15 14:20: User poweruser logged in',
                '2024-01-15 14:25: User poweruser accessed dashboard',
                '2024-01-15 15:00: User poweruser logged out'
            ];
            
            alert('Recent Audit Log:\n\n' + mockAuditLog.join('\n'));
        }
        
        // Settings tabs functionality
        // Load 2FA enforcement status
        window.load2FAEnforcementStatus = async function() {
            try {
                const response = await window.Api.request('GET', '/2fa/enforcement-status');
                if (response && response.success) {
                    const mode = response.mode || 'none';
                    const usersWithTFA = response.usersWithTFA || 0;
                    const twoFAGracePeriod = response.twoFAGracePeriod || 0;
                    
                    const enforcementModeEl = document.getElementById('twofa-enforcement-mode');
                    const usersCountEl = document.getElementById('twofa-users-count');
                    const gracePeriodEl = document.getElementById('twofa-grace-expires');
                    
                    if (enforcementModeEl) {
                        enforcementModeEl.textContent = 
                            mode === 'all-users' ? 'All Users' : 
                            mode === 'admins-only' ? 'Admins Only' : 
                            'Disabled';
                    }
                    
                    if (usersCountEl) {
                        usersCountEl.textContent = usersWithTFA;
                    }
                    
                    if (gracePeriodEl) {
                        if (twoFAGracePeriod > 0) {
                            gracePeriodEl.textContent = twoFAGracePeriod + ' days';
                        } else {
                            gracePeriodEl.textContent = 'Immediate';
                        }
                    }
                    
                    console.log('2FA enforcement status loaded:', { mode, usersWithTFA, twoFAGracePeriod });
                } else {
                    console.warn('No enforcement status data received:', response);
                }
            } catch (error) {
                console.error('Failed to load 2FA enforcement status:', error);
                // Set error state in UI
                const enforcementModeEl = document.getElementById('twofa-enforcement-mode');
                if (enforcementModeEl) {
                    enforcementModeEl.textContent = 'Error loading';
                    enforcementModeEl.style.color = '#ff6b93';
                }
            }
        }

        function initializeSettingsTabs() {
            // Use a small timeout to ensure DOM is fully ready
            setTimeout(() => {
                const tabs = document.querySelectorAll('.settings-tab');
                console.log('Found', tabs.length, 'tabs');
                
                // First, hide all sections
                const allSections = document.querySelectorAll('.settings-section');
                console.log('Found', allSections.length, 'sections');
                allSections.forEach(section => {
                    section.classList.remove('active-tab');
                });
                
                // Show General tab by default
                const generalSection = document.querySelector('#general-tab');
                console.log('General section found:', !!generalSection);
                if (generalSection) {
                    generalSection.classList.add('active-tab');
                    generalSection.style.display = 'block'; // Force display with inline style
                    generalSection.style.visibility = 'visible'; // Ensure visible
                    generalSection.style.opacity = '1'; // Ensure opaque
                    console.log('Added active-tab to general section');
                }
                
                const generalBtn = document.querySelector('.settings-tab[data-tab="general"]');
                console.log('General button found:', !!generalBtn);
                if (generalBtn) {
                    generalBtn.classList.add('active');
                    console.log('Added active class to general button');
                }
                
                // Keep checking and forcing General section to be visible for first 2 seconds
                let checkCount = 0;
                const keepVisible = setInterval(() => {
                    const genSection = document.querySelector('#general-tab');
                    if (genSection) {
                        genSection.style.display = 'block';
                        genSection.style.visibility = 'visible';
                        genSection.style.opacity = '1';
                    }
                    checkCount++;
                    if (checkCount > 20) { // Stop after 2 seconds (20 * 100ms)
                        clearInterval(keepVisible);
                        console.log('Stopped forcing General section visibility');
                    }
                }, 100);
                
                // Store the interval ID globally so tabs can clear it
                window.generalKeepVisibleInterval = keepVisible;
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Clear the keep-visible interval when switching tabs
                        if (window.generalKeepVisibleInterval) {
                            clearInterval(window.generalKeepVisibleInterval);
                            console.log('Cleared General section keep-visible interval');
                        }
                        
                        // Remove active class from all tabs and sections
                        tabs.forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.settings-section').forEach(section => {
                            section.classList.remove('active-tab');
                            section.style.display = ''; // Reset inline display style
                        });
                        
                        // Add active class to clicked tab
                        tab.classList.add('active');
                        
                        // Get the tab name
                        const tabName = tab.getAttribute('data-tab');
                        
                        // Show sections for this tab
                        const sections = document.querySelectorAll(`[data-tab="${tabName}"]`);
                        sections.forEach(section => {
                            section.classList.add('active-tab');
                            section.style.display = 'block'; // Ensure it shows
                        });
                        console.log('Tab switched to:', tabName);
                        
                        // Refresh 2FA enforcement status when security tab is opened
                        if (tabName === 'security') {
                            window.load2FAEnforcementStatus();
                        }
                        
                        // Initialize user management if users tab is activated
                        if (tabName === 'users' && users.length === 0) {
                            initUserManagement();
                        }
                    });
                });
                
                // Add user management button handler
                const userMgmtBtn = document.getElementById('go-to-user-mgmt');
                if (userMgmtBtn) {
                    userMgmtBtn.addEventListener('click', () => {
                        window.location.href = 'user-management.html';
                    });
                }

                // Setup 2FA modal event listeners
                setupTwoFAModalEventListeners();
            }, 100);
        }
        
        // Save security settings separately
        async function saveSecuritySettings() {
            try {
                const btn = document.getElementById('save-security');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                // Collect user-level security settings
                const securitySettings = {
                    sessionTimeout: { value: String(document.getElementById('session-timeout').value), category: 'security' },
                    maxConcurrentSessions: { value: String(document.getElementById('max-concurrent-sessions').value), category: 'security' },
                    auditLogging: { value: String(document.getElementById('audit-logging').checked), category: 'security' },
                    passwordPolicy: { value: String(document.getElementById('password-policy').checked), category: 'security' },
                    maxLoginAttempts: { value: String(document.getElementById('max-login-attempts').value), category: 'security' },
                    lockoutDuration: { value: String(document.getElementById('lockout-duration').value), category: 'security' }
                };
                
                // Collect system-level 2FA enforcement settings
                const twoFAEnforcementSettings = {
                    'enforce-2fa-all-users': { value: String(document.getElementById('enforce-2fa-all-users').checked), category: 'security' },
                    'twofa-grace-period': { value: String(document.getElementById('twofa-grace-period').value), category: 'security' },
                    'enforce-2fa-admins-only': { value: String(document.getElementById('enforce-2fa-admins-only').checked), category: 'security' }
                };
                
                // Save user-level security settings
                await window.Api.updateSettings(securitySettings, 'user');
                
                // Save system-level 2FA enforcement settings
                await window.Api.updateSettings(twoFAEnforcementSettings, 'system');
                
                // Update local settings
                for (const [key, data] of Object.entries(securitySettings)) {
                    let value = data.value;
                    if (value === 'true') value = true;
                    else if (value === 'false') value = false;
                    else if (!isNaN(value) && value !== '') value = Number(value);
                    settings[key] = value;
                }
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('Security settings saved successfully!', 'success');
                playSound('success');
                
                // Reload 2FA enforcement status to show updated data
                setTimeout(() => {
                    window.load2FAEnforcementStatus();
                }, 500);
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save security settings:', error);
                showNotification('Failed to save security settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-security');
                btn.innerHTML = '<i class="fas fa-save"></i> Save Security Settings';
                btn.disabled = false;
            }
        }
        
        // Save SSO settings
        async function saveSSOSettings() {
            try {
                const btn = document.getElementById('save-sso');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                btn.disabled = true;
                
                // Handle SSO configuration
                const ssoEnabled = document.getElementById('sso-enabled').checked;
                if (ssoEnabled) {
                    const ssoConfig = {
                        enabled: true,
                        issuerUrl: document.getElementById('sso-issuer-url').value,
                        clientId: document.getElementById('sso-client-id').value,
                        clientSecret: document.getElementById('sso-client-secret').value,
                        redirectUri: document.getElementById('sso-redirect-uri').value,
                        scopes: document.getElementById('sso-scopes').value
                    };

                    // Save SSO config to API
                    const ssoResponse = await fetch('/api/sso/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify(ssoConfig)
                    });

                    if (!ssoResponse.ok) {
                        throw new Error('Failed to save SSO configuration');
                    }
                } else {
                    // Disable SSO
                    await fetch('/api/sso/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify({ enabled: false })
                    });
                }
                
                // Save SSO enabled setting
                const ssoSettings = {
                    ssoEnabled: { value: String(ssoEnabled), category: 'sso' }
                };
                
                await window.Api.updateSettings(ssoSettings, 'user');
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                showNotification('SSO settings saved successfully!', 'success');
                playSound('success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Failed to save SSO settings:', error);
                showNotification('Failed to save SSO settings: ' + error.message, 'error');
                
                const btn = document.getElementById('save-sso');
                btn.innerHTML = '<i class="fas fa-save"></i> Save SSO Settings';
                btn.disabled = false;
            }
        }
        
        // Update navigation based on authentication state and user role
        function updateNavigation(user) {
            const navContainer = document.getElementById('main-nav');
            navContainer.innerHTML = '';
            
            // Always show dashboard button
            const dashboardBtn = document.createElement('button');
            dashboardBtn.className = 'nav-btn';
            dashboardBtn.onclick = () => window.location.href = 'index.html';
            dashboardBtn.innerHTML = '<i class="fas fa-home"></i> Dashboard';
            navContainer.appendChild(dashboardBtn);
            
            // Performance monitoring (available to all users)
            const performanceBtn = document.createElement('button');
            performanceBtn.className = 'nav-btn';
            performanceBtn.onclick = () => window.location.href = 'performance.html';
            performanceBtn.innerHTML = '<i class="fas fa-chart-line"></i> Performance';
            navContainer.appendChild(performanceBtn);
            
            // Admin-only navigation
            if (user.role === 'admin') {
                const settingsBtn = document.createElement('button');
                settingsBtn.className = 'nav-btn active';
                settingsBtn.onclick = () => window.location.href = 'settings.html';
                settingsBtn.innerHTML = '<i class="fas fa-cog"></i> Admin Settings';
                navContainer.appendChild(settingsBtn);
            }
            
            // Logout button for all authenticated users
            const logoutBtn = document.createElement('button');
            logoutBtn.className = 'nav-btn logout-btn';
            logoutBtn.onclick = () => window.Auth.logout();
            logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
            navContainer.appendChild(logoutBtn);
        }
        
        // Initialize tabs on page load
        document.addEventListener('DOMContentLoaded', initializeSettingsTabs);

        // ==========================================
        // SERVICE MANAGEMENT FUNCTIONALITY
        // ==========================================

        // Service Templates Database
        const SERVICE_TEMPLATES = {
            nextcloud: { name: 'Nextcloud', icon: 'fas fa-cloud', description: 'File sharing and collaboration platform with sync, calendar, and contacts' },
            synology: { name: 'Synology NAS', icon: 'fas fa-network-wired', description: 'Network attached storage with backup, media, and application features' },
            truenas: { name: 'TrueNAS', icon: 'fas fa-database', description: 'Open source network-attached storage and hyperconverged infrastructure' },
            seafile: { name: 'Seafile', icon: 'fas fa-share-alt', description: 'Self-hosted cloud storage and collaboration platform' },
            plex: { name: 'Plex Media Server', icon: 'fas fa-play-circle', description: 'Media streaming service for movies, TV shows, and music' },
            jellyfin: { name: 'Jellyfin', icon: 'fas fa-film', description: 'Free open source media streaming platform' },
            emby: { name: 'Emby', icon: 'fas fa-video', description: 'Powerful media server with streaming capabilities' },
            kaleidescape: { name: 'Kaleidescape', icon: 'fas fa-cube', description: 'Premium movie server and streaming solution' },
            gitlab: { name: 'GitLab', icon: 'fab fa-gitlab', description: 'Git repository management with CI/CD pipelines' },
            gitea: { name: 'Gitea', icon: 'fas fa-code-branch', description: 'Lightweight self-hosted Git repository management' },
            'github-enterprise': { name: 'GitHub Enterprise', icon: 'fab fa-github', description: 'Enterprise GitHub instance for private repositories' },
            jenkins: { name: 'Jenkins', icon: 'fas fa-cogs', description: 'Automation server for building and testing code' },
            mattermost: { name: 'Mattermost', icon: 'fas fa-comments', description: 'Self-hosted team communication and collaboration' },
            jitsi: { name: 'Jitsi Meet', icon: 'fas fa-video', description: 'Open source video conference platform' },
            rocketchat: { name: 'Rocket.Chat', icon: 'fas fa-rocket', description: 'Self-hosted team chat and collaboration platform' },
            matrix: { name: 'Matrix/Synapse', icon: 'fas fa-comments', description: 'Decentralized communication protocol and homeserver' },
            portainer: { name: 'Portainer', icon: 'fas fa-docker', description: 'Docker and Kubernetes container management platform' },
            unraid: { name: 'Unraid', icon: 'fas fa-server', description: 'NAS and virtualization operating system' },
            proxmox: { name: 'Proxmox VE', icon: 'fas fa-tv', description: 'Open source virtualization management platform' },
            esxi: { name: 'VMware ESXi', icon: 'fas fa-microchip', description: 'VMware hypervisor for virtual machines' },
            pfsense: { name: 'pfSense', icon: 'fas fa-shield-alt', description: 'Open source firewall and routing platform' },
            opnsense: { name: 'OPNsense', icon: 'fas fa-lock', description: 'Open source firewall and routing platform' },
            vaultwarden: { name: 'Vaultwarden', icon: 'fas fa-lock', description: 'Self-hosted password manager and vault' },
            keycloak: { name: 'Keycloak', icon: 'fas fa-key', description: 'Open source identity and access management' },
            authentik: { name: 'Authentik', icon: 'fas fa-shield-alt', description: 'Authentication and authorization platform' },
            qbittorrent: { name: 'qBittorrent', icon: 'fas fa-download', description: 'Lightweight BitTorrent client' },
            transmission: { name: 'Transmission', icon: 'fas fa-arrow-down', description: 'Open source BitTorrent client' },
            sonarr: { name: 'Sonarr', icon: 'fas fa-tv', description: 'TV show downloader and organizer' },
            radarr: { name: 'Radarr', icon: 'fas fa-film', description: 'Movie downloader and organizer' },
            lidarr: { name: 'Lidarr', icon: 'fas fa-music', description: 'Music downloader and organizer' },
            prowlarr: { name: 'Prowlarr', icon: 'fas fa-search', description: 'Indexer manager and proxy for *arr applications' },
            homeassistant: { name: 'Home Assistant', icon: 'fas fa-home', description: 'Open source home automation and IoT platform' },
            pihole: { name: 'Pi-hole', icon: 'fas fa-shield-alt', description: 'DNS sinkhole for ad-blocking and privacy' },
            adguard: { name: 'AdGuard Home', icon: 'fas fa-shield-alt', description: 'Network-wide ad and tracker blocker' },
            unmanic: { name: 'Unmanic', icon: 'fas fa-wand-magic-sparkles', description: 'Video transcoding automation' },
            openvpn: { name: 'OpenVPN', icon: 'fas fa-vpn-lock', description: 'Open source VPN solution' },
            wireguard: { name: 'WireGuard', icon: 'fas fa-vpn-lock', description: 'Modern VPN with improved security and performance' },
            wiki: { name: 'Wiki.js', icon: 'fas fa-book', description: 'Modern, lightweight wiki software' },
            confluence: { name: 'Confluence', icon: 'fas fa-file-alt', description: 'Team workspace and documentation platform' },
            mediawiki: { name: 'MediaWiki', icon: 'fas fa-database', description: 'Wiki engine that powers Wikipedia' }
        };

    </script>
    <script src="nav.js"></script>
    <script src="base.js"></script>
</body>
</html>